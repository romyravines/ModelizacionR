<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Modelización en R</title>
  <meta name="description" content="Curso-taller preparado para profesionales analiticos.">
  <meta name="generator" content="bookdown 0.5.13 and GitBook 2.6.7">

  <meta property="og:title" content="Modelización en R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Curso-taller preparado para profesionales analiticos." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Modelización en R" />
  
  <meta name="twitter:description" content="Curso-taller preparado para profesionales analiticos." />
  

<meta name="author" content="Aula Innova. Innova-tsn">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="metodos-de-re-muestreo.html">
<link rel="next" href="modelos-de-regresion-lineal.html">
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="assets/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="assets/proj4js-2.3.15/proj4.js"></script>
<link href="assets/highcharts-5.0.6/css/motion.css" rel="stylesheet" />
<script src="assets/highcharts-5.0.6/highstock.js"></script>
<script src="assets/highcharts-5.0.6/highcharts-3d.js"></script>
<script src="assets/highcharts-5.0.6/highcharts-more.js"></script>
<script src="assets/highcharts-5.0.6/modules/annotations.js"></script>
<script src="assets/highcharts-5.0.6/modules/broken-axis.js"></script>
<script src="assets/highcharts-5.0.6/modules/data.js"></script>
<script src="assets/highcharts-5.0.6/modules/drilldown.js"></script>
<script src="assets/highcharts-5.0.6/modules/exporting.js"></script>
<script src="assets/highcharts-5.0.6/modules/funnel.js"></script>
<script src="assets/highcharts-5.0.6/modules/heatmap.js"></script>
<script src="assets/highcharts-5.0.6/modules/map.js"></script>
<script src="assets/highcharts-5.0.6/modules/no-data-to-display.js"></script>
<script src="assets/highcharts-5.0.6/modules/offline-exporting.js"></script>
<script src="assets/highcharts-5.0.6/modules/solid-gauge.js"></script>
<script src="assets/highcharts-5.0.6/modules/treemap.js"></script>
<script src="assets/highcharts-5.0.6/plugins/annotations.js"></script>
<script src="assets/highcharts-5.0.6/plugins/draggable-legend.js"></script>
<script src="assets/highcharts-5.0.6/plugins/draggable-points.js"></script>
<script src="assets/highcharts-5.0.6/plugins/export-csv.js"></script>
<script src="assets/highcharts-5.0.6/plugins/grouped-categories.js"></script>
<script src="assets/highcharts-5.0.6/plugins/motion.js"></script>
<script src="assets/highcharts-5.0.6/plugins/pattern-fill-v2.js"></script>
<script src="assets/highcharts-5.0.6/plugins/tooltip-delay.js"></script>
<script src="assets/highcharts-5.0.6/custom/reset.js"></script>
<script src="assets/highcharts-5.0.6/custom/symbols-extra.js"></script>
<script src="assets/highcharts-5.0.6/custom/text-symbols.js"></script>
<link href="assets/fontawesome-4.5.0/font-awesome.min.css" rel="stylesheet" />
<link href="assets/htmlwdgtgrid-1/htmlwdgtgrid.css" rel="stylesheet" />
<script src="assets/highchart-binding-0.5.0/highchart.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Presentación</a></li>
<li class="part"><span><b>I MODELOS ANALÍTICOS</b></span></li>
<li class="chapter" data-level="1" data-path="modelizacion.html"><a href="modelizacion.html"><i class="fa fa-check"></i><b>1</b> Modelizar</a><ul>
<li class="chapter" data-level="1.1" data-path="modelizar.html"><a href="modelizar.html"><i class="fa fa-check"></i><b>1.1</b> ¿Qué es Modelizar?</a></li>
<li class="chapter" data-level="1.2" data-path="que-es-un-modelo-analitico.html"><a href="que-es-un-modelo-analitico.html"><i class="fa fa-check"></i><b>1.2</b> ¿Qué es un modelo analítico?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tipos-de-problemas.html"><a href="tipos-de-problemas.html"><i class="fa fa-check"></i><b>2</b> Tipos de Problemas</a><ul>
<li class="chapter" data-level="2.1" data-path="clasemodelos.html"><a href="clasemodelos.html"><i class="fa fa-check"></i><b>2.1</b> Enfoques de Modelización</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="catalogo-de-tecnicas.html"><a href="catalogo-de-tecnicas.html"><i class="fa fa-check"></i><b>3</b> Catálogo de Técnicas</a><ul>
<li class="chapter" data-level="3.1" data-path="tecnicas-de-clustering.html"><a href="tecnicas-de-clustering.html"><i class="fa fa-check"></i><b>3.1</b> Técnicas de <em>Clustering</em></a></li>
<li class="chapter" data-level="3.2" data-path="tecnicas-de-clasificacion.html"><a href="tecnicas-de-clasificacion.html"><i class="fa fa-check"></i><b>3.2</b> Técnicas de Clasificación</a></li>
<li class="chapter" data-level="3.3" data-path="tecnicas-de-regresion.html"><a href="tecnicas-de-regresion.html"><i class="fa fa-check"></i><b>3.3</b> Técnicas de Regresión</a></li>
<li class="chapter" data-level="3.4" data-path="tecnicas-de-reduccion-de-dimension.html"><a href="tecnicas-de-reduccion-de-dimension.html"><i class="fa fa-check"></i><b>3.4</b> Técnicas de Reducción de Dimensión</a></li>
<li class="chapter" data-level="3.5" data-path="otras-tecnicas.html"><a href="otras-tecnicas.html"><i class="fa fa-check"></i><b>3.5</b> Otras ‘Técnicas’</a></li>
<li class="chapter" data-level="3.6" data-path="que-tecnica-utilizar.html"><a href="que-tecnica-utilizar.html"><i class="fa fa-check"></i><b>3.6</b> ¿Qué técnica utilizar?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="evaluacion-de-modelos.html"><a href="evaluacion-de-modelos.html"><i class="fa fa-check"></i><b>4</b> Evaluación de modelos</a><ul>
<li class="chapter" data-level="4.1" data-path="diagnosis-de-negocio.html"><a href="diagnosis-de-negocio.html"><i class="fa fa-check"></i><b>4.1</b> Diagnosis de Negocio</a></li>
<li class="chapter" data-level="4.2" data-path="evaluacion-en-respuesta-binaria.html"><a href="evaluacion-en-respuesta-binaria.html"><i class="fa fa-check"></i><b>4.2</b> Evaluación en Respuesta Binaria</a><ul>
<li class="chapter" data-level="4.2.1" data-path="evaluacion-en-respuesta-binaria.html"><a href="evaluacion-en-respuesta-binaria.html#clasificacion"><i class="fa fa-check"></i><b>4.2.1</b> Clasificación</a></li>
<li class="chapter" data-level="4.2.2" data-path="evaluacion-en-respuesta-binaria.html"><a href="evaluacion-en-respuesta-binaria.html#medidas-de-desigualdad"><i class="fa fa-check"></i><b>4.2.2</b> Medidas de desigualdad</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="evaluacion-en-respuesta-continua.html"><a href="evaluacion-en-respuesta-continua.html"><i class="fa fa-check"></i><b>4.3</b> Evaluación en Respuesta Continúa</a><ul>
<li class="chapter" data-level="4.3.1" data-path="evaluacion-en-respuesta-continua.html"><a href="evaluacion-en-respuesta-continua.html#modelos-de-regresion"><i class="fa fa-check"></i><b>4.3.1</b> Modelos de Regresión</a></li>
<li class="chapter" data-level="4.3.2" data-path="evaluacion-en-respuesta-continua.html"><a href="evaluacion-en-respuesta-continua.html#modelos-de-series-temporales"><i class="fa fa-check"></i><b>4.3.2</b> Modelos de Series temporales</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="evaluacion-en-clustering.html"><a href="evaluacion-en-clustering.html"><i class="fa fa-check"></i><b>4.4</b> Evaluación en <em>Clustering</em></a><ul>
<li class="chapter" data-level="4.4.1" data-path="evaluacion-en-clustering.html"><a href="evaluacion-en-clustering.html#silueta"><i class="fa fa-check"></i><b>4.4.1</b> Silueta</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="metodos-de-re-muestreo.html"><a href="metodos-de-re-muestreo.html"><i class="fa fa-check"></i><b>4.5</b> Métodos de re-muestreo</a><ul>
<li class="chapter" data-level="4.5.1" data-path="metodos-de-re-muestreo.html"><a href="metodos-de-re-muestreo.html#training-testing"><i class="fa fa-check"></i><b>4.5.1</b> Training &amp; testing</a></li>
<li class="chapter" data-level="4.5.2" data-path="metodos-de-re-muestreo.html"><a href="metodos-de-re-muestreo.html#cross-validation"><i class="fa fa-check"></i><b>4.5.2</b> Cross validation</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="practica-en-r.html"><a href="practica-en-r.html"><i class="fa fa-check"></i><b>4.6</b> Práctica en R</a><ul>
<li class="chapter" data-level="4.6.1" data-path="practica-en-r.html"><a href="practica-en-r.html#preparacion-de-los-datos"><i class="fa fa-check"></i><b>4.6.1</b> Preparación de los datos</a></li>
<li class="chapter" data-level="4.6.2" data-path="practica-en-r.html"><a href="practica-en-r.html#clasificacion-1"><i class="fa fa-check"></i><b>4.6.2</b> Clasificación</a></li>
<li class="chapter" data-level="4.6.3" data-path="practica-en-r.html"><a href="practica-en-r.html#regresion"><i class="fa fa-check"></i><b>4.6.3</b> Regresión</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Modelos Estadísticos</b></span></li>
<li class="chapter" data-level="5" data-path="modelos-de-regresion-lineal.html"><a href="modelos-de-regresion-lineal.html"><i class="fa fa-check"></i><b>5</b> Modelos de regresión lineal</a><ul>
<li class="chapter" data-level="5.1" data-path="modelo.html"><a href="modelo.html"><i class="fa fa-check"></i><b>5.1</b> Modelo</a></li>
<li class="chapter" data-level="5.2" data-path="aplicacion-en-r.html"><a href="aplicacion-en-r.html"><i class="fa fa-check"></i><b>5.2</b> Aplicación en R</a><ul>
<li class="chapter" data-level="5.2.1" data-path="aplicacion-en-r.html"><a href="aplicacion-en-r.html#regresion-lineal-simple"><i class="fa fa-check"></i><b>5.2.1</b> Regresión lineal simple</a></li>
<li class="chapter" data-level="5.2.2" data-path="aplicacion-en-r.html"><a href="aplicacion-en-r.html#regresion-lineal-multiple"><i class="fa fa-check"></i><b>5.2.2</b> Regresión lineal múltiple</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="modelos-de-respuesta-0-1.html"><a href="modelos-de-respuesta-0-1.html"><i class="fa fa-check"></i><b>6</b> Modelos de Respuesta 0-1</a><ul>
<li class="chapter" data-level="6.1" data-path="motivacion.html"><a href="motivacion.html"><i class="fa fa-check"></i><b>6.1</b> Motivación</a></li>
<li class="chapter" data-level="6.2" data-path="modelos-lineales-generalizados.html"><a href="modelos-lineales-generalizados.html"><i class="fa fa-check"></i><b>6.2</b> Modelos Lineales Generalizados</a></li>
<li class="chapter" data-level="6.3" data-path="modelo-logit.html"><a href="modelo-logit.html"><i class="fa fa-check"></i><b>6.3</b> Modelo Logit</a></li>
<li class="chapter" data-level="6.4" data-path="modelo-probit.html"><a href="modelo-probit.html"><i class="fa fa-check"></i><b>6.4</b> Modelo Probit</a></li>
<li class="chapter" data-level="6.5" data-path="modelos-de-regresion-logistica.html"><a href="modelos-de-regresion-logistica.html"><i class="fa fa-check"></i><b>6.5</b> Modelos de regresión logística</a></li>
<li class="chapter" data-level="6.6" data-path="aplicacion-en-r-1.html"><a href="aplicacion-en-r-1.html"><i class="fa fa-check"></i><b>6.6</b> Aplicación en R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="modelos-de-series-temporales-1.html"><a href="modelos-de-series-temporales-1.html"><i class="fa fa-check"></i><b>7</b> Modelos de Series Temporales</a><ul>
<li class="chapter" data-level="7.1" data-path="series-temporales.html"><a href="series-temporales.html"><i class="fa fa-check"></i><b>7.1</b> Series Temporales</a><ul>
<li class="chapter" data-level="7.1.1" data-path="series-temporales.html"><a href="series-temporales.html#que-es-una-serie-temporal"><i class="fa fa-check"></i><b>7.1.1</b> ¿Qué es una Serie Temporal?</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="operadores.html"><a href="operadores.html"><i class="fa fa-check"></i><b>7.2</b> Operadores</a><ul>
<li class="chapter" data-level="7.2.1" data-path="operadores.html"><a href="operadores.html#operador-de-retardo-simple"><i class="fa fa-check"></i><b>7.2.1</b> Operador de retardo simple</a></li>
<li class="chapter" data-level="7.2.2" data-path="operadores.html"><a href="operadores.html#operador-de-adelanto-simple"><i class="fa fa-check"></i><b>7.2.2</b> Operador de adelanto simple</a></li>
<li class="chapter" data-level="7.2.3" data-path="operadores.html"><a href="operadores.html#polinomios-en-b"><i class="fa fa-check"></i><b>7.2.3</b> Polinomios en B</a></li>
<li class="chapter" data-level="7.2.4" data-path="operadores.html"><a href="operadores.html#operador-diferencia"><i class="fa fa-check"></i><b>7.2.4</b> Operador diferencia</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="alisado-exponencial.html"><a href="alisado-exponencial.html"><i class="fa fa-check"></i><b>7.3</b> Alisado Exponencial</a><ul>
<li class="chapter" data-level="7.3.1" data-path="alisado-exponencial.html"><a href="alisado-exponencial.html#que-es-el-alisado-exponencial"><i class="fa fa-check"></i><b>7.3.1</b> ¿Qué es el Alisado Exponencial?</a></li>
<li class="chapter" data-level="7.3.2" data-path="alisado-exponencial.html"><a href="alisado-exponencial.html#librerias"><i class="fa fa-check"></i><b>7.3.2</b> Librerías</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="lectura-y-visualizacion.html"><a href="lectura-y-visualizacion.html"><i class="fa fa-check"></i><b>7.4</b> Lectura y Visualización</a><ul>
<li class="chapter" data-level="7.4.1" data-path="lectura-y-visualizacion.html"><a href="lectura-y-visualizacion.html#datos-originales"><i class="fa fa-check"></i><b>7.4.1</b> Datos Originales</a></li>
<li class="chapter" data-level="7.4.2" data-path="lectura-y-visualizacion.html"><a href="lectura-y-visualizacion.html#objeto-xts"><i class="fa fa-check"></i><b>7.4.2</b> Objeto XTS</a></li>
<li class="chapter" data-level="7.4.3" data-path="lectura-y-visualizacion.html"><a href="lectura-y-visualizacion.html#seleccion-de-datos-usando-las-fechas"><i class="fa fa-check"></i><b>7.4.3</b> Selección de datos usando las fechas</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="manipulacion.html"><a href="manipulacion.html"><i class="fa fa-check"></i><b>7.5</b> Manipulación</a><ul>
<li class="chapter" data-level="7.5.1" data-path="manipulacion.html"><a href="manipulacion.html#cambios-de-fechado"><i class="fa fa-check"></i><b>7.5.1</b> Cambios de Fechado</a></li>
<li class="chapter" data-level="7.5.2" data-path="manipulacion.html"><a href="manipulacion.html#imputacion-de-datos-faltantes"><i class="fa fa-check"></i><b>7.5.2</b> Imputación de Datos Faltantes</a></li>
<li class="chapter" data-level="7.5.3" data-path="manipulacion.html"><a href="manipulacion.html#estadisticos-en-diferentes-fechados"><i class="fa fa-check"></i><b>7.5.3</b> Estadísticos en diferentes fechados</a></li>
<li class="chapter" data-level="7.5.4" data-path="manipulacion.html"><a href="manipulacion.html#division-del-conjunto-de-datos-usando-fechas"><i class="fa fa-check"></i><b>7.5.4</b> División del conjunto de datos usando fechas</a></li>
<li class="chapter" data-level="7.5.5" data-path="manipulacion.html"><a href="manipulacion.html#otras-operaciones-con-los-datos"><i class="fa fa-check"></i><b>7.5.5</b> Otras operaciones con los datos</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="graficos.html"><a href="graficos.html"><i class="fa fa-check"></i><b>7.6</b> Gráficos</a><ul>
<li class="chapter" data-level="7.6.1" data-path="graficos.html"><a href="graficos.html#con-xts"><i class="fa fa-check"></i><b>7.6.1</b> Con xts</a></li>
<li class="chapter" data-level="7.6.2" data-path="graficos.html"><a href="graficos.html#con-highcharter"><i class="fa fa-check"></i><b>7.6.2</b> Con highcharter</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Machine Learning</b></span></li>
<li class="chapter" data-level="8" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html"><i class="fa fa-check"></i><b>8</b> Unsupervised Learning</a><ul>
<li class="chapter" data-level="8.1" data-path="k-means.html"><a href="k-means.html"><i class="fa fa-check"></i><b>8.1</b> K-means</a><ul>
<li class="chapter" data-level="8.1.1" data-path="k-means.html"><a href="k-means.html#modelo-1"><i class="fa fa-check"></i><b>8.1.1</b> Modelo</a></li>
<li class="chapter" data-level="8.1.2" data-path="k-means.html"><a href="k-means.html#implementacion-en-r"><i class="fa fa-check"></i><b>8.1.2</b> Implementación en R</a></li>
<li class="chapter" data-level="8.1.3" data-path="k-means.html"><a href="k-means.html#evaluacion"><i class="fa fa-check"></i><b>8.1.3</b> Evaluación</a></li>
<li class="chapter" data-level="8.1.4" data-path="k-means.html"><a href="k-means.html#determinar-el-numero-de-clusters-optimo"><i class="fa fa-check"></i><b>8.1.4</b> Determinar el número de clústers óptimo</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html"><i class="fa fa-check"></i><b>8.2</b> Hierarchical clustering</a><ul>
<li class="chapter" data-level="8.2.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#modelo-2"><i class="fa fa-check"></i><b>8.2.1</b> Modelo</a></li>
<li class="chapter" data-level="8.2.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#implementacion-en-r-1"><i class="fa fa-check"></i><b>8.2.2</b> Implementación en R</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="other-clustering-methods.html"><a href="other-clustering-methods.html"><i class="fa fa-check"></i><b>8.3</b> Other clustering methods</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="random-forests.html"><a href="random-forests.html"><i class="fa fa-check"></i><b>9</b> Random Forests</a><ul>
<li class="chapter" data-level="9.1" data-path="a-entrenamiento-del-modelo-rf-clasificacion.html"><a href="a-entrenamiento-del-modelo-rf-clasificacion.html"><i class="fa fa-check"></i><b>9.1</b> A. Entrenamiento del modelo RF-clasificación</a><ul>
<li class="chapter" data-level="9.1.1" data-path="a-entrenamiento-del-modelo-rf-clasificacion.html"><a href="a-entrenamiento-del-modelo-rf-clasificacion.html#criterio-de-la-distancia-de-ks"><i class="fa fa-check"></i><b>9.1.1</b> Criterio de la distancia de KS:</a></li>
<li class="chapter" data-level="9.1.2" data-path="a-entrenamiento-del-modelo-rf-clasificacion.html"><a href="a-entrenamiento-del-modelo-rf-clasificacion.html#grafico-de-la-curva-roc-y-su-metrica-asociada"><i class="fa fa-check"></i><b>9.1.2</b> Gráfico de la Curva ROC y su métrica asociada</a></li>
<li class="chapter" data-level="9.1.3" data-path="a-entrenamiento-del-modelo-rf-clasificacion.html"><a href="a-entrenamiento-del-modelo-rf-clasificacion.html#metrica-de-error-del-clasificador-rf"><i class="fa fa-check"></i><b>9.1.3</b> Métrica de error del clasificador RF:</a></li>
<li class="chapter" data-level="9.1.4" data-path="a-entrenamiento-del-modelo-rf-clasificacion.html"><a href="a-entrenamiento-del-modelo-rf-clasificacion.html#ejercicio-propuesto"><i class="fa fa-check"></i><b>9.1.4</b> Ejercicio propuesto:</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="b-entrenamiento-del-modelo-rf-regresion.html"><a href="b-entrenamiento-del-modelo-rf-regresion.html"><i class="fa fa-check"></i><b>9.2</b> B. Entrenamiento del modelo RF-regresión</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="gradient-boosting-models.html"><a href="gradient-boosting-models.html"><i class="fa fa-check"></i><b>10</b> Gradient Boosting Models</a><ul>
<li class="chapter" data-level="10.1" data-path="c-entrenamiento-del-modelo-gbm-clasificacion.html"><a href="c-entrenamiento-del-modelo-gbm-clasificacion.html"><i class="fa fa-check"></i><b>10.1</b> C. Entrenamiento del modelo GBM-clasificación</a></li>
<li class="chapter" data-level="10.2" data-path="d-entrenamiento-del-modelo-gbm-regresion.html"><a href="d-entrenamiento-del-modelo-gbm-regresion.html"><i class="fa fa-check"></i><b>10.2</b> D. Entrenamiento del modelo GBM-regresión</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="support-vector-machines.html"><a href="support-vector-machines.html"><i class="fa fa-check"></i><b>11</b> Support Vector Machines</a><ul>
<li class="chapter" data-level="11.1" data-path="introduccion.html"><a href="introduccion.html"><i class="fa fa-check"></i><b>11.1</b> Introducción</a></li>
<li class="chapter" data-level="11.2" data-path="descripcion.html"><a href="descripcion.html"><i class="fa fa-check"></i><b>11.2</b> Descripción</a></li>
<li class="chapter" data-level="11.3" data-path="svm-clasificacion-ejemplo.html"><a href="svm-clasificacion-ejemplo.html"><i class="fa fa-check"></i><b>11.3</b> SVM-clasificación: ejemplo</a></li>
<li class="chapter" data-level="11.4" data-path="f-entrenamiento-del-modelo-svm-regresion.html"><a href="f-entrenamiento-del-modelo-svm-regresion.html"><i class="fa fa-check"></i><b>11.4</b> F. Entrenamiento del modelo SVM-regresión</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="incompleto.html"><a href="incompleto.html"><i class="fa fa-check"></i><b>12</b> Incompleto…</a><ul>
<li class="chapter" data-level="12.0.1" data-path="incompleto.html"><a href="incompleto.html#g.-comparativa-de-modelos-de-clasificacin"><i class="fa fa-check"></i><b>12.0.1</b> G. comparativa de modelos de clasificaci?n</a></li>
<li class="chapter" data-level="12.0.2" data-path="incompleto.html"><a href="incompleto.html#curvas-roc-1"><i class="fa fa-check"></i><b>12.0.2</b> Curvas ROC</a></li>
<li class="chapter" data-level="12.0.3" data-path="incompleto.html"><a href="incompleto.html#falta---incompleto"><i class="fa fa-check"></i><b>12.0.3</b> falta - Incompleto</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="boosting.html"><a href="boosting.html"><i class="fa fa-check"></i><b>13</b> Boosting</a><ul>
<li class="chapter" data-level="13.1" data-path="que-es-boosting.html"><a href="que-es-boosting.html"><i class="fa fa-check"></i><b>13.1</b> ¿Qué es boosting?</a></li>
<li class="chapter" data-level="13.2" data-path="modelos-ensamblados.html"><a href="modelos-ensamblados.html"><i class="fa fa-check"></i><b>13.2</b> Modelos ensamblados</a></li>
<li class="chapter" data-level="13.3" data-path="adaboost.html"><a href="adaboost.html"><i class="fa fa-check"></i><b>13.3</b> AdaBoost</a><ul>
<li class="chapter" data-level="13.3.1" data-path="adaboost.html"><a href="adaboost.html#idea-intuitiva"><i class="fa fa-check"></i><b>13.3.1</b> Idea intuitiva</a></li>
<li class="chapter" data-level="13.3.2" data-path="adaboost.html"><a href="adaboost.html#nomenclatura"><i class="fa fa-check"></i><b>13.3.2</b> Nomenclatura</a></li>
<li class="chapter" data-level="13.3.3" data-path="adaboost.html"><a href="adaboost.html#adaboost.-algoritmo"><i class="fa fa-check"></i><b>13.3.3</b> AdaBoost. Algoritmo</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="funciones-de-perdida.html"><a href="funciones-de-perdida.html"><i class="fa fa-check"></i><b>13.4</b> Funciones de pérdida</a><ul>
<li class="chapter" data-level="13.4.1" data-path="funciones-de-perdida.html"><a href="funciones-de-perdida.html#funciones-de-perdida-regresion-lineal"><i class="fa fa-check"></i><b>13.4.1</b> Funciones de pérdida: Regresión lineal</a></li>
<li class="chapter" data-level="13.4.2" data-path="funciones-de-perdida.html"><a href="funciones-de-perdida.html#funciones-de-perdida-clasificacion."><i class="fa fa-check"></i><b>13.4.2</b> Funciones de pérdida: Clasificación.</a></li>
<li class="chapter" data-level="13.4.3" data-path="funciones-de-perdida.html"><a href="funciones-de-perdida.html#funciones-de-perdida-para-clasificacion."><i class="fa fa-check"></i><b>13.4.3</b> Funciones de pérdida para clasificación.</a></li>
<li class="chapter" data-level="13.4.4" data-path="funciones-de-perdida.html"><a href="funciones-de-perdida.html#perdida-exponencial"><i class="fa fa-check"></i><b>13.4.4</b> Pérdida exponencial</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="algoritmo-adaboost-revisitado.html"><a href="algoritmo-adaboost-revisitado.html"><i class="fa fa-check"></i><b>13.5</b> Algoritmo AdaBoost Revisitado</a><ul>
<li class="chapter" data-level="13.5.1" data-path="algoritmo-adaboost-revisitado.html"><a href="algoritmo-adaboost-revisitado.html#adaboost-en-accion"><i class="fa fa-check"></i><b>13.5.1</b> AdaBoost en acción</a></li>
<li class="chapter" data-level="13.5.2" data-path="algoritmo-adaboost-revisitado.html"><a href="algoritmo-adaboost-revisitado.html#adaboost.-propiedades"><i class="fa fa-check"></i><b>13.5.2</b> AdaBoost. Propiedades</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="gradient-boosting.html"><a href="gradient-boosting.html"><i class="fa fa-check"></i><b>13.6</b> Gradient boosting</a><ul>
<li class="chapter" data-level="13.6.1" data-path="gradient-boosting.html"><a href="gradient-boosting.html#algoritmo"><i class="fa fa-check"></i><b>13.6.1</b> Algoritmo</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="optimizacion-numerica.html"><a href="optimizacion-numerica.html"><i class="fa fa-check"></i><b>13.7</b> Optimización numérica</a><ul>
<li class="chapter" data-level="13.7.1" data-path="optimizacion-numerica.html"><a href="optimizacion-numerica.html#descenso-del-gradiente-gradient-descent"><i class="fa fa-check"></i><b>13.7.1</b> Descenso del gradiente (gradient descent)</a></li>
<li class="chapter" data-level="13.7.2" data-path="optimizacion-numerica.html"><a href="optimizacion-numerica.html#a-jugar"><i class="fa fa-check"></i><b>13.7.2</b> ¡A jugar!</a></li>
</ul></li>
<li class="chapter" data-level="13.8" data-path="funciones-de-perdida-mas-habituales.html"><a href="funciones-de-perdida-mas-habituales.html"><i class="fa fa-check"></i><b>13.8</b> Funciones de pérdida más habituales</a></li>
<li class="chapter" data-level="13.9" data-path="parametro-de-shrinkage.html"><a href="parametro-de-shrinkage.html"><i class="fa fa-check"></i><b>13.9</b> Parámetro de <em>shrinkage</em></a></li>
<li class="chapter" data-level="13.10" data-path="otros-metodos.html"><a href="otros-metodos.html"><i class="fa fa-check"></i><b>13.10</b> Otros métodos</a></li>
</ul></li>
<li class="appendix"><span><b>ANEXO</b></span></li>
<li class="chapter" data-level="A" data-path="sobre-in-training.html"><a href="sobre-in-training.html"><i class="fa fa-check"></i><b>A</b> Sobre in-training</a></li>
<li class="chapter" data-level="B" data-path="colaboradores.html"><a href="colaboradores.html"><i class="fa fa-check"></i><b>B</b> Colaboradores</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modelización en R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="practica-en-r" class="section level2">
<h2><span class="header-section-number">4.6</span> Práctica en R</h2>
<div class="info">
<p>Evaluaremos la calidad predictiva de dos modelos:</p>
<ul>
<li>Cuando la variable respuesta es binaria.</li>
<li>Cuando la variable respuesta es contínua.</li>
</ul>
</div>
<div id="preparacion-de-los-datos" class="section level3">
<h3><span class="header-section-number">4.6.1</span> Preparación de los datos</h3>
<blockquote>
<p>Definimos el Entorno de Trabajo</p>
</blockquote>
<p>El primer paso es crear una carpeta con nuestros modelos y resultados dentro de nuestro espacio de trabajo (proyecto).</p>
<ul>
<li>Obtenemos la ruta completa del directorio de trabajo<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">myWD &lt;-<span class="st"> </span><span class="kw">getwd</span>() </a></code></pre></div>
<ul>
<li>Elegimos un nombre para nuestra carpeta con resultados</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">myWorkingFolderName &lt;-<span class="st"> &#39;ModelResults&#39;</span> </a></code></pre></div>
<ul>
<li>Creamos la carpeta donde guardaremos nuestros resultados y ficheros</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">dir.create</span>( <span class="kw">paste0</span>(<span class="kw">getwd</span>(),<span class="st">&quot;/&quot;</span>,myWorkingFolderName))</a></code></pre></div>
<blockquote>
<p>Accedemos a los datos originales</p>
</blockquote>
<ul>
<li>Cargamos la librería <code>insuranceData</code> que contiene los datos que utilizaremos<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(insuranceData)) <span class="kw">install.packages</span>(<span class="st">&#39;insuranceData&#39;</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">library</span>(insuranceData)</a></code></pre></div>
<ul>
<li>Para ver los contenidos de la librería <code>insuranceData</code> ejecutamos:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">data</span>(<span class="dt">package=</span><span class="st">&#39;insuranceData&#39;</span>)</a></code></pre></div>
<ul>
<li><p>Vemos que hay 10 datasets. Trabajaremos con el primero: <code>AutoBi</code> (<em>Automobile Bodily Injury Claims</em><a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>).</p></li>
<li><p>Cargamos el conjunto de datos seleccionado: <strong>pérdidas en accidentes de coches</strong></p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;AutoBi&quot;</span>)</a></code></pre></div>
<ul>
<li><p>Descripción de las 8 variables del conjunto de datos (<em>tabla</em>) ‘AutoBi’:</p>
<ol style="list-style-type: decimal">
<li><code>Casenum</code>. Identificador de la reclamación (esta variable no se utiliza en los modelos)</li>
<li><code>Attorney</code>. Indica si el reclamante está representado por un <strong>abogado</strong> (1= Sí, 2 = No)</li>
<li><code>Clmsex</code>. <strong>Sexo</strong> del reclamante (1 = Hombre, 2 = Mujer)</li>
<li><code>Marital</code>. <strong>Estado Civil</strong> del reclamante (1 = Casado, 2 = Soltero, 3 = Viudo, 4 = divorciado/separado)</li>
<li><code>Clminsur</code>. Indica si el conductor del vehículo del reclamante estaba o no <strong>asegurado</strong> (1 = Si, 2 = No, 3 = No aplica)</li>
<li><code>Seatbelt</code>. Si el reclamante llevaba o no un <strong>cinturón</strong> de seguridad en el asiento infantil (1 = Si, 2 = No, 3 = No Aplica)</li>
<li><code>Clmage</code>. <strong>Edad</strong> del reclamante.</li>
<li><code>Loss (*)</code>. La <strong>pérdida económica</strong> total del reclamante (en miles). Esta es la variable objetivo o dependiente del conjunto de datos.</li>
</ol></li>
<li><p>Revisamos el contenido de la tabla y el tipo de datos que contiene</p></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">str</span>(AutoBi)</a></code></pre></div>
<pre><code>FALSE &#39;data.frame&#39;: 1340 obs. of  8 variables:
FALSE  $ CASENUM : int  5 13 66 71 96 97 120 136 152 155 ...
FALSE  $ ATTORNEY: int  1 2 2 1 2 1 1 1 2 2 ...
FALSE  $ CLMSEX  : int  1 2 1 1 1 2 1 2 2 1 ...
FALSE  $ MARITAL : int  NA 2 2 1 4 1 2 2 2 2 ...
FALSE  $ CLMINSUR: int  2 1 2 2 2 2 2 2 2 2 ...
FALSE  $ SEATBELT: int  1 1 1 2 1 1 1 1 1 1 ...
FALSE  $ CLMAGE  : int  50 28 5 32 30 35 19 34 61 NA ...
FALSE  $ LOSS    : num  34.94 10.892 0.33 11.037 0.138 ...</code></pre>
<ul>
<li>Exploramos el contenido con estadísticos descriptivos básicos</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">summary</span>(AutoBi)</a></code></pre></div>
<pre><code>FALSE     CASENUM         ATTORNEY         CLMSEX         MARITAL     
FALSE  Min.   :    5   Min.   :1.000   Min.   :1.000   Min.   :1.000  
FALSE  1st Qu.: 8579   1st Qu.:1.000   1st Qu.:1.000   1st Qu.:1.000  
FALSE  Median :17453   Median :1.000   Median :2.000   Median :2.000  
FALSE  Mean   :17213   Mean   :1.489   Mean   :1.559   Mean   :1.593  
FALSE  3rd Qu.:25703   3rd Qu.:2.000   3rd Qu.:2.000   3rd Qu.:2.000  
FALSE  Max.   :34253   Max.   :2.000   Max.   :2.000   Max.   :4.000  
FALSE                                  NA&#39;s   :12      NA&#39;s   :16     
FALSE     CLMINSUR        SEATBELT         CLMAGE           LOSS         
FALSE  Min.   :1.000   Min.   :1.000   Min.   : 0.00   Min.   :   0.005  
FALSE  1st Qu.:2.000   1st Qu.:1.000   1st Qu.:19.00   1st Qu.:   0.640  
FALSE  Median :2.000   Median :1.000   Median :31.00   Median :   2.331  
FALSE  Mean   :1.908   Mean   :1.017   Mean   :32.53   Mean   :   5.954  
FALSE  3rd Qu.:2.000   3rd Qu.:1.000   3rd Qu.:43.00   3rd Qu.:   3.995  
FALSE  Max.   :2.000   Max.   :2.000   Max.   :95.00   Max.   :1067.697  
FALSE  NA&#39;s   :41      NA&#39;s   :48      NA&#39;s   :189</code></pre>
<ul>
<li>Para llamar directamente a las variables por sus nombres en la tabla AutoBi utilizamos el comando <code>attach</code></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">attach</span>(AutoBi)</a></code></pre></div>
<blockquote>
<p>Exploramos la variable objetivo</p>
</blockquote>
<div class="info">
<p>LOSS es la <strong>variable objetivo</strong> una variable altamente asimétrica (con posibles outliers a la derecha o pérdida muy severa)<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>.</p>
</div>
<ul>
<li>Analizamos la variable target</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">summary</span>(LOSS)</a></code></pre></div>
<pre><code>FALSE     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
FALSE    0.005    0.640    2.331    5.954    3.995 1067.697</code></pre>
<ul>
<li>Analizamos la distribución de la variable target</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">hist</span>(LOSS, <span class="dt">breaks=</span><span class="dv">300</span> , <span class="dt">probability =</span> T)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">lines</span>(<span class="kw">density</span>(LOSS), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">main=</span><span class="st">&quot;Loss distribution&quot;</span>)</a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-20-1.png" width="672" /></p>
<ul>
<li>Utilizamos una medida <em>robusta</em> (depende de la mediana y del IQR<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>) para segmentar los datos en dos clases:</li>
<li><code>1</code> si las pérdidas son atípicamente altas o</li>
<li><code>0</code> si no lo son.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">lsup &lt;-<span class="st"> </span><span class="kw">median</span>(LOSS) <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span><span class="op">*</span><span class="kw">IQR</span>(LOSS) <span class="co"># Criterio basado en estadisticos robustos</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">sum</span>(LOSS<span class="op">&gt;=</span>lsup) <span class="co"># 153 datos de perdidas atipicamente altas</span></a></code></pre></div>
<pre><code>FALSE [1] 153</code></pre>
<ul>
<li>(Opcional) Guardamos el gráfico del histograma de las <strong>pérdidas no severas</strong></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">  Path_to_graphics &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">getwd</span>(),<span class="st">&quot;/&quot;</span>,<span class="st">&quot;Graphics&quot;</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">  <span class="kw">dir.create</span>(Path_to_graphics)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  <span class="kw">png</span>(<span class="kw">paste0</span>(Path_to_graphics,<span class="st">&quot;/histograma.png&quot;</span>))</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  <span class="kw">hist</span>(LOSS[LOSS<span class="op">&lt;</span>lsup], <span class="dt">breaks =</span> <span class="dv">100</span>, <span class="dt">probability =</span> T, <span class="dt">xlab=</span><span class="st">&quot;loss (pérdida en miles US $)&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Pérdida no severa&quot;</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">  <span class="kw">lines</span>(<span class="kw">density</span>(LOSS[LOSS<span class="op">&lt;</span>lsup]),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">  <span class="kw">dev.off</span>()</a></code></pre></div>
<pre><code>FALSE png 
FALSE   2</code></pre>
<blockquote>
<p>Creamos el <em>dataset</em> de trabajo.</p>
</blockquote>
<ul>
<li>Creamos un dataset o tabla de trabajo eliminando la variable CASENUM (id) y filtrando por la variable LOSS y el valor lsup= 72.22587 (miles).</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">df_autobi &lt;-<span class="st"> </span>AutoBi[ , <span class="op">-</span><span class="kw">match</span>(<span class="st">&quot;CASENUM&quot;</span>, <span class="kw">colnames</span>(AutoBi)) ] </a></code></pre></div>
<ul>
<li><p>Fijamos los predictores categóricos como factores:</p>
<ul>
<li>Representado por un abogado: ‘1’ = representado por letrado y ‘2’ = no representado</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">  df_autobi<span class="op">$</span>ATTORNEY &lt;-<span class="st"> </span><span class="kw">ordered</span>(df_autobi<span class="op">$</span>ATTORNEY, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) </a></code></pre></div>
<ul>
<li>Sexo: ‘1’ = hombre y ‘2’ = mujer</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">  df_autobi<span class="op">$</span>CLMSEX   &lt;-<span class="st"> </span><span class="kw">ordered</span>(df_autobi<span class="op">$</span>CLMSEX  , <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a></code></pre></div>
<ul>
<li>Estado civil: ‘1’ = casado, ‘2’ = soltero, ‘3’ = viudo y ‘4’ = divorciado / separado</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">  df_autobi<span class="op">$</span>MARITAL  &lt;-<span class="st"> </span><span class="kw">ordered</span>(df_autobi<span class="op">$</span>MARITAL , <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</a></code></pre></div>
<ul>
<li>Vehículo asegurado: ‘1’ = vehículo estaba asegurado y ‘2’= no lo estaba</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">  df_autobi<span class="op">$</span>CLMINSUR &lt;-<span class="st"> </span><span class="kw">ordered</span>(df_autobi<span class="op">$</span>CLMINSUR, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) </a></code></pre></div>
<ul>
<li>Cinturón de seguridad: ‘1’ = llevaba cinturón abrochado y ‘2’ = no lo llevaba</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">  df_autobi<span class="op">$</span>SEATBELT &lt;-<span class="st"> </span><span class="kw">ordered</span>(df_autobi<span class="op">$</span>SEATBELT, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a></code></pre></div>
<ul>
<li>Pérdida: ‘1’= pérdida severa y ‘2’= pérdida no severa</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">df_autobi<span class="op">$</span>Y        &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df_autobi<span class="op">$</span>LOSS<span class="op">&gt;=</span><span class="st"> </span>lsup,<span class="dv">1</span>,<span class="dv">0</span>)</a></code></pre></div>
<ul>
<li>Exploramos el <em>dataset</em> que acabamos de crear y verificamos la proporción de casos con pérdida severa (11.42%)</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">summary</span>(df_autobi)</a></code></pre></div>
<pre><code>FALSE  ATTORNEY  CLMSEX    MARITAL    CLMINSUR    SEATBELT        CLMAGE     
FALSE  1:685    1   :586   1   :624   1   : 120   1   :1270   Min.   : 0.00  
FALSE  2:655    2   :742   2   :650   2   :1179   2   :  22   1st Qu.:19.00  
FALSE           NA&#39;s: 12   3   : 15   NA&#39;s:  41   NA&#39;s:  48   Median :31.00  
FALSE                      4   : 35                           Mean   :32.53  
FALSE                      NA&#39;s: 16                           3rd Qu.:43.00  
FALSE                                                         Max.   :95.00  
FALSE                                                         NA&#39;s   :189    
FALSE       LOSS                Y         
FALSE  Min.   :   0.005   Min.   :0.0000  
FALSE  1st Qu.:   0.640   1st Qu.:0.0000  
FALSE  Median :   2.331   Median :0.0000  
FALSE  Mean   :   5.954   Mean   :0.1142  
FALSE  3rd Qu.:   3.995   3rd Qu.:0.0000  
FALSE  Max.   :1067.697   Max.   :1.0000  
FALSE </code></pre>
<ul>
<li>Exploramos la relación de la pérdida con los factores.</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">agg_loss_attorney &lt;-<span class="st"> </span><span class="kw">aggregate</span>(LOSS, <span class="dt">by =</span> <span class="kw">list</span>(ATTORNEY) , <span class="dt">FUN=</span> mean , <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">  <span class="kw">dimnames</span>(agg_loss_attorney)[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;REPRESENTED&quot;</span>,<span class="st">&quot;NOT REPRESENTED&quot;</span>) ; <span class="kw">dimnames</span>(agg_loss_attorney)[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ATTORNEY&quot;</span>,<span class="st">&quot;LOSS&quot;</span>)</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb28-4" data-line-number="4">  agg_loss_clmsex   &lt;-<span class="st"> </span><span class="kw">aggregate</span>(LOSS, <span class="dt">by =</span> <span class="kw">list</span>(CLMSEX)  , <span class="dt">FUN=</span> mean , <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">  <span class="kw">dimnames</span>(agg_loss_clmsex)[[<span class="dv">1</span>]]   &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MALE&quot;</span>,<span class="st">&quot;FEMALE&quot;</span>)  ; <span class="kw">dimnames</span>(agg_loss_clmsex)[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;CLMSEX&quot;</span>,<span class="st">&quot;LOSS&quot;</span>)</a>
<a class="sourceLine" id="cb28-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb28-7" data-line-number="7">  agg_loss_marital  &lt;-<span class="st"> </span><span class="kw">aggregate</span>(LOSS, <span class="dt">by =</span> <span class="kw">list</span>(MARITAL) , <span class="dt">FUN=</span> mean , <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">  <span class="kw">dimnames</span>(agg_loss_marital)[[<span class="dv">1</span>]]  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MARRIED&quot;</span>,<span class="st">&quot;SINGLE&quot;</span>,<span class="st">&quot;WIDOW&quot;</span>,<span class="st">&quot;DIVORCED&quot;</span>) ; <span class="kw">dimnames</span>(agg_loss_marital)[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MARITAL&quot;</span>,<span class="st">&quot;LOSS&quot;</span>)</a>
<a class="sourceLine" id="cb28-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb28-10" data-line-number="10">  agg_loss_clminsur &lt;-<span class="st"> </span><span class="kw">aggregate</span>(LOSS, <span class="dt">by =</span> <span class="kw">list</span>(CLMINSUR) , <span class="dt">FUN=</span> mean , <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb28-11" data-line-number="11">  <span class="kw">dimnames</span>(agg_loss_clminsur)[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;INSURED&quot;</span>,<span class="st">&quot;NOT INSURED&quot;</span>) ; <span class="kw">dimnames</span>(agg_loss_clminsur)[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;CLMINSUR&quot;</span>,<span class="st">&quot;LOSS&quot;</span>)</a>
<a class="sourceLine" id="cb28-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb28-13" data-line-number="13">  agg_loss_seatbelt &lt;-<span class="st"> </span><span class="kw">aggregate</span>(LOSS, <span class="dt">by =</span> <span class="kw">list</span>(SEATBELT) , <span class="dt">FUN=</span> mean , <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb28-14" data-line-number="14">  <span class="kw">dimnames</span>(agg_loss_seatbelt)[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;SEATBELT&quot;</span>,<span class="st">&quot;NOT SEATBELT&quot;</span>) ; <span class="kw">dimnames</span>(agg_loss_seatbelt)[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;SEATBELT&quot;</span>,<span class="st">&quot;LOSS&quot;</span>)</a></code></pre></div>
<blockquote>
<p>Creamos los sets <em>train</em> y <em>test</em></p>
</blockquote>
<ul>
<li>Aleatorizamos los datos y separamos el set de datos en <em>train</em> y <em>test</em>:</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">N=<span class="kw">nrow</span>(df_autobi)</a></code></pre></div>
<ul>
<li>Es recomendable fijar una semilla (seed) para los algoritmos de aleatorización internos de R</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(caret)) <span class="kw">install.packages</span>(<span class="st">&#39;caret&#39;</span>)</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw">library</span>(caret)  </a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">123456</span>)</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">inTrain  &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(df_autobi<span class="op">$</span>Y, <span class="dt">times =</span> <span class="dv">1</span>, <span class="dt">p =</span> <span class="fl">0.7</span>, <span class="dt">list =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">dt_train &lt;-<span class="st"> </span>df_autobi[inTrain[[<span class="dv">1</span>]],]  <span class="co"># 938 casos</span></a>
<a class="sourceLine" id="cb30-6" data-line-number="6">dt_test  &lt;-<span class="st"> </span>df_autobi[<span class="op">-</span>inTrain[[<span class="dv">1</span>]],] <span class="co"># 402 casos</span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb30-8" data-line-number="8"><span class="kw">nrow</span>(dt_train)</a></code></pre></div>
<pre><code>FALSE [1] 938</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">summary</span>(dt_train)</a></code></pre></div>
<pre><code>FALSE  ATTORNEY  CLMSEX    MARITAL    CLMINSUR   SEATBELT       CLMAGE     
FALSE  1:471    1   :406   1   :439   1   : 77   1   :885   Min.   : 0.00  
FALSE  2:467    2   :523   2   :455   2   :833   2   : 17   1st Qu.:20.00  
FALSE           NA&#39;s:  9   3   : 10   NA&#39;s: 28   NA&#39;s: 36   Median :32.00  
FALSE                      4   : 25                         Mean   :33.06  
FALSE                      NA&#39;s:  9                         3rd Qu.:43.00  
FALSE                                                       Max.   :95.00  
FALSE                                                       NA&#39;s   :134    
FALSE       LOSS                Y         
FALSE  Min.   :  0.0050   Min.   :0.0000  
FALSE  1st Qu.:  0.7123   1st Qu.:0.0000  
FALSE  Median :  2.3645   Median :0.0000  
FALSE  Mean   :  5.4656   Mean   :0.1141  
FALSE  3rd Qu.:  4.0263   3rd Qu.:0.0000  
FALSE  Max.   :273.6040   Max.   :1.0000  
FALSE </code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">nrow</span>(dt_test)</a></code></pre></div>
<pre><code>FALSE [1] 402</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw">summary</span>(dt_test)</a></code></pre></div>
<pre><code>FALSE  ATTORNEY  CLMSEX    MARITAL    CLMINSUR   SEATBELT       CLMAGE     
FALSE  1:214    1   :180   1   :185   1   : 43   1   :385   Min.   : 0.00  
FALSE  2:188    2   :219   2   :195   2   :346   2   :  5   1st Qu.:19.00  
FALSE           NA&#39;s:  3   3   :  5   NA&#39;s: 13   NA&#39;s: 12   Median :29.00  
FALSE                      4   : 10                         Mean   :31.31  
FALSE                      NA&#39;s:  7                         3rd Qu.:42.00  
FALSE                                                       Max.   :78.00  
FALSE                                                       NA&#39;s   :55     
FALSE       LOSS                 Y         
FALSE  Min.   :   0.0050   Min.   :0.0000  
FALSE  1st Qu.:   0.5175   1st Qu.:0.0000  
FALSE  Median :   2.1645   Median :0.0000  
FALSE  Mean   :   7.0917   Mean   :0.1144  
FALSE  3rd Qu.:   3.7782   3rd Qu.:0.0000  
FALSE  Max.   :1067.6970   Max.   :1.0000  
FALSE </code></pre>
<p>Comprobamos si se que los conjuntos train y test se han formado correctamente</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">  <span class="kw">length</span>(<span class="kw">intersect</span>(inTrain, <span class="kw">setdiff</span>(<span class="dv">1</span><span class="op">:</span>N,inTrain)))</a></code></pre></div>
<pre><code>FALSE [1] 0</code></pre>
</div>
<div id="clasificacion-1" class="section level3">
<h3><span class="header-section-number">4.6.2</span> Clasificación</h3>
<div class="info">
<p>Vamos a construir un modelo para identificar los casos con pérdidas severas.</p>
</div>
<ul>
<li>El primer ejemplo lo hacemos con <em>Random Forest</em></li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(randomForest)) <span class="kw">install.packages</span>(<span class="st">&#39;randomForest&#39;</span>)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="kw">library</span>(randomForest)</a></code></pre></div>
<ul>
<li>Creamos un objeto de clase ‘formula’ y se lo pasamos como argumento a la función <code>randomForest</code><a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123456</span>)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">fmla.rf1 &lt;-<span class="st"> </span><span class="kw">as.formula</span>(<span class="kw">paste0</span>(<span class="st">&quot;Y&quot;</span>,<span class="st">&quot; ~&quot;</span>,<span class="kw">paste0</span>(<span class="kw">colnames</span>(df_autobi[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">8</span>)]),<span class="dt">collapse =</span> <span class="st">&quot;+&quot;</span>),<span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">rf1 &lt;-<span class="st"> </span><span class="kw">randomForest</span>( fmla.rf1,</a>
<a class="sourceLine" id="cb41-4" data-line-number="4">                       <span class="dt">data =</span>dt_train,</a>
<a class="sourceLine" id="cb41-5" data-line-number="5">                       <span class="dt">ntree =</span> <span class="dv">5000</span>, <span class="co"># se ejecuta muy rapido, podemos utilizar ntree &gt; = 2500</span></a>
<a class="sourceLine" id="cb41-6" data-line-number="6">                       <span class="dt">replace =</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb41-7" data-line-number="7">                       <span class="dt">mtry=</span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb41-8" data-line-number="8">                       <span class="dt">maxnodes =</span><span class="dv">50</span>,</a>
<a class="sourceLine" id="cb41-9" data-line-number="9">                       <span class="dt">importance =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb41-10" data-line-number="10">                       <span class="dt">proximity =</span>   <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb41-11" data-line-number="11">                       <span class="dt">keep.forest =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb41-12" data-line-number="12">                       <span class="dt">na.action=</span>na.omit)</a></code></pre></div>
<ul>
<li>Exploramos el objeto con los resutados</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">rf1</a></code></pre></div>
<pre><code>FALSE 
FALSE Call:
FALSE  randomForest(formula = fmla.rf1, data = dt_train, ntree = 5000,      replace = TRUE, mtry = 4, maxnodes = 50, importance = TRUE,      proximity = TRUE, keep.forest = TRUE, na.action = na.omit) 
FALSE                Type of random forest: regression
FALSE                      Number of trees: 5000
FALSE No. of variables tried at each split: 4
FALSE 
FALSE           Mean of squared residuals: 0.1038307
FALSE                     % Var explained: 1.6</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">summary</span>(rf1)</a></code></pre></div>
<pre><code>FALSE                 Length Class  Mode     
FALSE call                11 -none- call     
FALSE type                 1 -none- character
FALSE predicted          759 -none- numeric  
FALSE mse               5000 -none- numeric  
FALSE rsq               5000 -none- numeric  
FALSE oob.times          759 -none- numeric  
FALSE importance          12 -none- numeric  
FALSE importanceSD         6 -none- numeric  
FALSE localImportance      0 -none- NULL     
FALSE proximity       576081 -none- numeric  
FALSE ntree                1 -none- numeric  
FALSE mtry                 1 -none- numeric  
FALSE forest              11 -none- list     
FALSE coefs                0 -none- NULL     
FALSE y                  759 -none- numeric  
FALSE test                 0 -none- NULL     
FALSE inbag                0 -none- NULL     
FALSE terms                3 terms  call     
FALSE na.action          179 omit   numeric</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">str</span>(rf1)</a></code></pre></div>
<pre><code>FALSE List of 19
FALSE  $ call           : language randomForest(formula = fmla.rf1, data = dt_train, ntree = 5000, replace = TRUE,      mtry = 4, maxnodes = 50, imp| __truncated__ ...
FALSE  $ type           : chr &quot;regression&quot;
FALSE  $ predicted      : atomic [1:759] 0.007273 0.000081 0.675016 0.006908 0.017108 ...
FALSE   ..- attr(*, &quot;na.action&quot;)=Class &#39;omit&#39;  Named int [1:179] 1 9 19 25 27 40 43 46 50 51 ...
FALSE   .. .. ..- attr(*, &quot;names&quot;)= chr [1:179] &quot;1&quot; &quot;10&quot; &quot;24&quot; &quot;30&quot; ...
FALSE  $ mse            : num [1:5000] 0.104 0.119 0.117 0.12 0.121 ...
FALSE  $ rsq            : num [1:5000] 0.0107 -0.1241 -0.112 -0.1409 -0.1452 ...
FALSE  $ oob.times      : int [1:759] 1836 1929 1846 1829 1860 1811 1808 1830 1811 1797 ...
FALSE  $ importance     : num [1:6, 1:2] 0.016961 -0.002353 0.004298 0.000851 0.001241 ...
FALSE   ..- attr(*, &quot;dimnames&quot;)=List of 2
FALSE   .. ..$ : chr [1:6] &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; &quot;CLMINSUR&quot; ...
FALSE   .. ..$ : chr [1:2] &quot;%IncMSE&quot; &quot;IncNodePurity&quot;
FALSE  $ importanceSD   : Named num [1:6] 1.63e-04 1.05e-04 1.70e-04 8.66e-05 5.90e-05 ...
FALSE   ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; &quot;CLMINSUR&quot; ...
FALSE  $ localImportance: NULL
FALSE  $ proximity      : num [1:759, 1:759] 1 0.192 0 0.427 0 ...
FALSE   ..- attr(*, &quot;dimnames&quot;)=List of 2
FALSE   .. ..$ : chr [1:759] &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; ...
FALSE   .. ..$ : chr [1:759] &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; ...
FALSE  $ ntree          : num 5000
FALSE  $ mtry           : num 4
FALSE  $ forest         :List of 11
FALSE   ..$ ndbigtree    : int [1:5000] 99 99 99 99 99 99 99 99 99 99 ...
FALSE   ..$ nodestatus   : int [1:99, 1:5000] -3 -3 -3 -3 -3 -3 -3 -1 -1 -3 ...
FALSE   ..$ leftDaughter : int [1:99, 1:5000] 2 4 6 8 10 12 14 0 0 16 ...
FALSE   ..$ rightDaughter: int [1:99, 1:5000] 3 5 7 9 11 13 15 0 0 17 ...
FALSE   ..$ nodepred     : num [1:99, 1:5000] 1.26e-01 1.50e-02 1.66e-01 1.53e-16 2.61e-02 ...
FALSE   ..$ bestvar      : int [1:99, 1:5000] 6 6 3 6 6 1 4 0 0 1 ...
FALSE   ..$ xbestsplit   : num [1:99, 1:5000] 20.5 15.5 3.5 3.5 17.5 1.5 1.5 0 0 1.5 ...
FALSE   ..$ ncat         : Named int [1:6] 1 1 1 1 1 1
FALSE   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; &quot;CLMINSUR&quot; ...
FALSE   ..$ nrnodes      : int 99
FALSE   ..$ ntree        : num 5000
FALSE   ..$ xlevels      :List of 6
FALSE   .. ..$ ATTORNEY: num 0
FALSE   .. ..$ CLMSEX  : num 0
FALSE   .. ..$ MARITAL : num 0
FALSE   .. ..$ CLMINSUR: num 0
FALSE   .. ..$ SEATBELT: num 0
FALSE   .. ..$ CLMAGE  : num 0
FALSE  $ coefs          : NULL
FALSE  $ y              : atomic [1:759] 1 0 1 0 0 0 0 0 0 1 ...
FALSE   ..- attr(*, &quot;na.action&quot;)=Class &#39;omit&#39;  Named int [1:179] 1 9 19 25 27 40 43 46 50 51 ...
FALSE   .. .. ..- attr(*, &quot;names&quot;)= chr [1:179] &quot;1&quot; &quot;10&quot; &quot;24&quot; &quot;30&quot; ...
FALSE  $ test           : NULL
FALSE  $ inbag          : NULL
FALSE  $ terms          :Classes &#39;terms&#39;, &#39;formula&#39;  language Y ~ ATTORNEY + CLMSEX + MARITAL + CLMINSUR + SEATBELT + CLMAGE
FALSE   .. ..- attr(*, &quot;variables&quot;)= language list(Y, ATTORNEY, CLMSEX, MARITAL, CLMINSUR, SEATBELT, CLMAGE)
FALSE   .. ..- attr(*, &quot;factors&quot;)= int [1:7, 1:6] 0 1 0 0 0 0 0 0 0 1 ...
FALSE   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
FALSE   .. .. .. ..$ : chr [1:7] &quot;Y&quot; &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; ...
FALSE   .. .. .. ..$ : chr [1:6] &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; &quot;CLMINSUR&quot; ...
FALSE   .. ..- attr(*, &quot;term.labels&quot;)= chr [1:6] &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; &quot;CLMINSUR&quot; ...
FALSE   .. ..- attr(*, &quot;order&quot;)= int [1:6] 1 1 1 1 1 1
FALSE   .. ..- attr(*, &quot;intercept&quot;)= num 0
FALSE   .. ..- attr(*, &quot;response&quot;)= int 1
FALSE   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
FALSE   .. ..- attr(*, &quot;predvars&quot;)= language list(Y, ATTORNEY, CLMSEX, MARITAL, CLMINSUR, SEATBELT, CLMAGE)
FALSE   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:7] &quot;numeric&quot; &quot;ordered&quot; &quot;ordered&quot; &quot;ordered&quot; ...
FALSE   .. .. ..- attr(*, &quot;names&quot;)= chr [1:7] &quot;Y&quot; &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; ...
FALSE  $ na.action      :Class &#39;omit&#39;  Named int [1:179] 1 9 19 25 27 40 43 46 50 51 ...
FALSE   .. ..- attr(*, &quot;names&quot;)= chr [1:179] &quot;1&quot; &quot;10&quot; &quot;24&quot; &quot;30&quot; ...
FALSE  - attr(*, &quot;class&quot;)= chr [1:2] &quot;randomForest.formula&quot; &quot;randomForest&quot;</code></pre>
<blockquote>
<p>Gráfico de la importancia relativa de los predictores</p>
</blockquote>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">  <span class="kw">varImpPlot</span>(rf1,<span class="dt">sort =</span> T,<span class="dt">main =</span> <span class="st">&quot;Variable Importance&quot;</span>)</a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-37-1.png" width="672" /></p>
<blockquote>
<p>Gráfico del Error vs número de árboles</p>
</blockquote>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">  <span class="kw">plot</span>(rf1, <span class="dt">main=</span><span class="st">&quot;Error de clasificación vs núero de  árboles&quot;</span>) </a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-38-1.png" width="672" /></p>
<blockquote>
<p>Gráfico de la probabilidad condicional: <span class="math inline">\(P(Y=1|X_1 = ATTORNEY,\ldots,X_6=SEATBELT)\)</span></p>
</blockquote>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">  rf1.prediction &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(rf1, <span class="dt">newdata =</span> dt_train))</a>
<a class="sourceLine" id="cb50-2" data-line-number="2">  <span class="kw">summary</span>(rf1.prediction)</a></code></pre></div>
<pre><code>##  predict(rf1, newdata = dt_train)
##  Min.   :0.00007                 
##  1st Qu.:0.00483                 
##  Median :0.03644                 
##  Mean   :0.12016                 
##  3rd Qu.:0.20796                 
##  Max.   :0.80442                 
##  NA&#39;s   :179</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1">  dt_train<span class="op">$</span>pred_rf1 &lt;-<span class="st"> </span>rf1.prediction<span class="op">$</span><span class="st">`</span><span class="dt">predict(rf1, newdata = dt_train)</span><span class="st">`</span> </a>
<a class="sourceLine" id="cb52-2" data-line-number="2">  <span class="kw">head</span>(dt_train,<span class="dv">3</span>)</a></code></pre></div>
<pre><code>##   ATTORNEY CLMSEX MARITAL CLMINSUR SEATBELT CLMAGE   LOSS Y     pred_rf1
## 1        1      1    &lt;NA&gt;        2        1     50 34.940 1           NA
## 2        2      2       2        1        1     28 10.892 1 3.739339e-01
## 3        2      1       2        2        1      5  0.330 0 6.700844e-05</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">  <span class="kw">tail</span>(dt_train,<span class="dv">3</span>)</a></code></pre></div>
<pre><code>##      ATTORNEY CLMSEX MARITAL CLMINSUR SEATBELT CLMAGE  LOSS Y     pred_rf1
## 1335        2      2       2        2        1     26 0.161 0 0.0007159829
## 1338        2      2       1        2        1     39 0.099 0 0.0080326490
## 1340        2      2       2        2        1     30 0.688 0 0.0011077024</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">  <span class="kw">summary</span>(dt_train)</a></code></pre></div>
<pre><code>##  ATTORNEY  CLMSEX    MARITAL    CLMINSUR   SEATBELT       CLMAGE     
##  1:471    1   :406   1   :439   1   : 77   1   :885   Min.   : 0.00  
##  2:467    2   :523   2   :455   2   :833   2   : 17   1st Qu.:20.00  
##           NA&#39;s:  9   3   : 10   NA&#39;s: 28   NA&#39;s: 36   Median :32.00  
##                      4   : 25                         Mean   :33.06  
##                      NA&#39;s:  9                         3rd Qu.:43.00  
##                                                       Max.   :95.00  
##                                                       NA&#39;s   :134    
##       LOSS                Y             pred_rf1      
##  Min.   :  0.0050   Min.   :0.0000   Min.   :0.00007  
##  1st Qu.:  0.7123   1st Qu.:0.0000   1st Qu.:0.00483  
##  Median :  2.3645   Median :0.0000   Median :0.03644  
##  Mean   :  5.4656   Mean   :0.1141   Mean   :0.12016  
##  3rd Qu.:  4.0263   3rd Qu.:0.0000   3rd Qu.:0.20796  
##  Max.   :273.6040   Max.   :1.0000   Max.   :0.80442  
##                                      NA&#39;s   :179</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1">  <span class="kw">plot</span>(<span class="kw">density</span>(dt_train<span class="op">$</span>pred_rf1[<span class="op">!</span><span class="kw">is.na</span>(dt_train<span class="op">$</span>pred_rf1)]), <span class="dt">col=</span><span class="st">&quot;red&quot;</span> , <span class="dt">xlab=</span><span class="st">&quot;Probabilidad&quot;</span> , <span class="dt">main=</span><span class="st">&quot;Función de densidad estimada&quot;</span>)</a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-39-1.png" width="672" /></p>
<ul>
<li><p>Vemos que hay (claramente) dos concentraciones (clases) de probabilidades de pérdida, una concentración en torno a la probabilidad de pérdida no severa (<span class="math inline">\(Y=0\)</span>) y otra para la pérdida severa (<span class="math inline">\(Y=1\)</span>).</p></li>
<li><p>Esto no lleva a la elección del <strong>punto de corte óptimo</strong> para obtener una regla de clasificación, es decir, un criterio para <span class="math inline">\(Y_{predicted}=1\)</span> (pérdida severa), o bien, para <span class="math inline">\(Y_{predicted}=0\)</span> (pérdida no severa). Una alternativa es el criterio de la <strong>Distancia de Kolmogorov-Smirnov</strong> (KS).</p></li>
</ul>
<blockquote>
<p>Métricas de evaluación del poder de clasificación</p>
</blockquote>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(ModelMetrics)) <span class="kw">install.packages</span>(<span class="st">&#39;ModelMetrics&#39;</span>)</a>
<a class="sourceLine" id="cb59-2" data-line-number="2"><span class="kw">library</span>(ModelMetrics)</a>
<a class="sourceLine" id="cb59-3" data-line-number="3"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(ROCR)) <span class="kw">install.packages</span>(<span class="st">&#39;ROCR&#39;</span>)</a>
<a class="sourceLine" id="cb59-4" data-line-number="4"><span class="kw">library</span>(ROCR)</a>
<a class="sourceLine" id="cb59-5" data-line-number="5"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(binaryLogic)) <span class="kw">install.packages</span>(<span class="st">&#39;binaryLogic&#39;</span>)</a>
<a class="sourceLine" id="cb59-6" data-line-number="6"><span class="kw">library</span>(binaryLogic)</a></code></pre></div>
<ul>
<li>Con el train creamos un objeto de tipo ‘prediction’<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a></li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1">  rf1.pred &lt;-<span class="st"> </span><span class="kw">prediction</span>(<span class="kw">as.numeric</span>(rf1<span class="op">$</span>predicted),<span class="kw">as.numeric</span>(rf1<span class="op">$</span>y)) </a></code></pre></div>
<ul>
<li>Calculamos la Curva de ROC con la función ‘performance’ sobre el objeto ‘rf1’</li>
</ul>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">  rf1.perf &lt;-<span class="st"> </span><span class="kw">performance</span>(rf1.pred,<span class="st">&quot;tpr&quot;</span>,<span class="st">&quot;fpr&quot;</span>) </a>
<a class="sourceLine" id="cb61-2" data-line-number="2"> ## &quot;fpr&quot; = False positive rate. P(Yhat = + | Y = -). Estimated as: FP/N.</a>
<a class="sourceLine" id="cb61-3" data-line-number="3"> ## &quot;tpr&quot; = True positive rate. P(Yhat = + | Y = +). Estimated as: TP/P.</a>
<a class="sourceLine" id="cb61-4" data-line-number="4"> <span class="kw">plot</span>(rf1.perf)</a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-42-1.png" width="672" /></p>
<blockquote>
<p>Elección del punto de corte: Criterio de la distancia de KS</p>
</blockquote>
<ul>
<li>La distancia KS se calcula como: KS = abs(<a href="mailto:rf1.perf@y.values">rf1.perf@y.values</a>[[1]]-<a href="mailto:rf1.perf@x.values">rf1.perf@x.values</a>[[1]])</li>
</ul>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">rf1.perf<span class="op">@</span>alpha.values[[<span class="dv">1</span>]][rf1.perf<span class="op">@</span>alpha.values[[<span class="dv">1</span>]]<span class="op">==</span><span class="ot">Inf</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">max</span>(rf1.perf<span class="op">@</span>alpha.values[[<span class="dv">1</span>]][rf1.perf<span class="op">@</span>alpha.values[[<span class="dv">1</span>]]<span class="op">!=</span><span class="ot">Inf</span>]),<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb62-2" data-line-number="2">KS.matrix=<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">abs</span>(rf1.perf<span class="op">@</span>y.values[[<span class="dv">1</span>]]<span class="op">-</span>rf1.perf<span class="op">@</span>x.values[[<span class="dv">1</span>]]), rf1.perf<span class="op">@</span>alpha.values[[<span class="dv">1</span>]])</a></code></pre></div>
<ul>
<li>Resumiendo</li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw">colnames</span>(KS.matrix) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;KS-distance&quot;</span>,<span class="st">&quot;cut-point&quot;</span>)</a>
<a class="sourceLine" id="cb63-2" data-line-number="2"><span class="kw">head</span>(KS.matrix)</a></code></pre></div>
<pre><code>##      KS-distance cut-point
## [1,] 0.000000000 0.7800000
## [2,] 0.001497006 0.7826242
## [3,] 0.002994012 0.7452204
## [4,] 0.007994999 0.6750160
## [5,] 0.006497993 0.6717595
## [6,] 0.005000987 0.6529603</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1">ind.ks  &lt;-<span class="st"> </span><span class="kw">sort</span>( KS.matrix[,<span class="dv">1</span>] , <span class="dt">index.return=</span><span class="ot">TRUE</span> )<span class="op">$</span>ix[<span class="kw">nrow</span>(KS.matrix)] </a></code></pre></div>
<ul>
<li>El punto de corte óptimo de KS:</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">  rf1.KScutoff &lt;-<span class="st"> </span>KS.matrix[ind.ks,<span class="dv">2</span>] <span class="co"># := f(rf1.KS1)</span></a>
<a class="sourceLine" id="cb66-2" data-line-number="2">  rf1.KScutoff</a></code></pre></div>
<pre><code>##  cut-point 
## 0.05177067</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="co"># 0.04 - 0.05 </span></a></code></pre></div>
<blockquote>
<p>Gráfico de la Curva ROC y su métrica: Área bajo la curva ROC (AUC)</p>
</blockquote>
<ul>
<li>Cálculo de AUC mediante la función ‘performance’</li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">rf1.auc1 &lt;-<span class="st"> </span><span class="kw">performance</span>(rf1.pred,<span class="st">&quot;auc&quot;</span>)<span class="op">@</span>y.values[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb69-2" data-line-number="2">rf1.auc1</a></code></pre></div>
<pre><code>FALSE [1] 0.7368889</code></pre>
<p>-Cálculo de la curva ROC junto con la métrica AUC</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="co">#win.graph()</span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2"><span class="kw">plot</span>( rf1.perf , <span class="dt">col=</span><span class="st">&#39;red&#39;</span>  , <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Tasa de falsos positivos&quot;</span> , <span class="dt">ylab=</span><span class="st">&quot;Tasa de verdaderos positivos&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Curva ROC con Random Forest&quot;</span>)</a>
<a class="sourceLine" id="cb71-3" data-line-number="3"><span class="kw">abline</span>( <span class="dv">0</span> , <span class="dv">1</span>  , <span class="dt">col=</span><span class="st">&quot;blue&quot;</span> , <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb71-4" data-line-number="4"><span class="kw">abline</span>( <span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">1</span> , <span class="dt">col=</span><span class="st">&quot;gray40&quot;</span>   , <span class="dt">lty=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="kw">legend</span>( <span class="fl">0.4</span>, <span class="fl">0.15</span> , <span class="kw">c</span>(<span class="kw">paste0</span>(<span class="st">&quot;AUC (Random Forest)=&quot;</span>,<span class="kw">round</span>(rf1.auc1,<span class="dv">4</span>)),<span class="st">&quot;AUC (clasificacion al azar)=0.50&quot;</span>),<span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">lwd=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>) ,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>), <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-47-1.png" width="672" /></p>
<ul>
<li>Se realizar el mismo gráfico de la curva ROC utilizando la librería <code>ggplot2</code>. Para ello guardamos los datos en un <code>data.frame</code></li>
</ul>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</a>
<a class="sourceLine" id="cb72-2" data-line-number="2">df.perf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>rf1.perf<span class="op">@</span>x.values[[<span class="dv">1</span>]],<span class="dt">y=</span>rf1.perf<span class="op">@</span>y.values[[<span class="dv">1</span>]])</a></code></pre></div>
<ul>
<li>Construcción del objeto gráfico con <code>ggplot2</code></li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="co">#win.graph()</span></a>
<a class="sourceLine" id="cb73-2" data-line-number="2">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df.perf,<span class="kw">aes</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_path</span>(<span class="dt">size=</span><span class="dv">1</span>, <span class="dt">colour=</span><span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb73-3" data-line-number="3">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Curva ROC modelo Random Forest&quot;</span>)</a>
<a class="sourceLine" id="cb73-4" data-line-number="4">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme_update</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb73-5" data-line-number="5">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">0</span>,<span class="dt">y=</span><span class="dv">0</span>,<span class="dt">xend=</span><span class="dv">1</span>,<span class="dt">yend=</span><span class="dv">1</span>),<span class="dt">colour=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">linetype=</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb73-6" data-line-number="6">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="fl">0.75</span> , <span class="dt">y=</span><span class="fl">0.3</span> , <span class="dt">label=</span><span class="kw">paste</span>(<span class="dt">sep =</span><span class="st">&quot;&quot;</span>,<span class="st">&quot;AUC (Random Forest) ) = &quot;</span>,<span class="kw">round</span>(rf1.auc1,<span class="dv">4</span>) )),<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">size=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb73-7" data-line-number="7">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="fl">0.75</span> , <span class="dt">y=</span><span class="fl">0.25</span> , <span class="dt">label=</span><span class="kw">paste</span>(<span class="dt">sep =</span><span class="st">&quot;&quot;</span>,<span class="st">&quot;AUC (Coin toss) = &quot;</span>,<span class="kw">round</span>(<span class="fl">0.50</span>,<span class="dv">4</span>) )),<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">size=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb73-8" data-line-number="8">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">name=</span> <span class="st">&quot;Tasa de falsos positivos&quot;</span>)</a>
<a class="sourceLine" id="cb73-9" data-line-number="9">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">name=</span> <span class="st">&quot;Tasa de verdaderos positivos&quot;</span>)</a>
<a class="sourceLine" id="cb73-10" data-line-number="10">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb73-11" data-line-number="11">  <span class="dt">plot.title   =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb73-12" data-line-number="12">  <span class="dt">axis.text.x  =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb73-13" data-line-number="13">  <span class="dt">axis.text.y  =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb73-14" data-line-number="14">  <span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>,<span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>),</a>
<a class="sourceLine" id="cb73-15" data-line-number="15">  <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>,<span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>,<span class="dt">angle=</span><span class="dv">90</span>),</a>
<a class="sourceLine" id="cb73-16" data-line-number="16">  <span class="dt">legend.title     =</span> <span class="kw">element_blank</span>(), </a>
<a class="sourceLine" id="cb73-17" data-line-number="17">  <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey&quot;</span>),</a>
<a class="sourceLine" id="cb73-18" data-line-number="18">  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), </a>
<a class="sourceLine" id="cb73-19" data-line-number="19">  <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">colour=</span><span class="st">&#39;white&#39;</span>),</a>
<a class="sourceLine" id="cb73-20" data-line-number="20">  <span class="dt">plot.background  =</span> <span class="kw">element_blank</span>()</a>
<a class="sourceLine" id="cb73-21" data-line-number="21">)</a>
<a class="sourceLine" id="cb73-22" data-line-number="22"></a>
<a class="sourceLine" id="cb73-23" data-line-number="23">p</a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-49-1.png" width="672" /></p>
<blockquote>
<p>Métricas de evaluación del poder predictivo</p>
</blockquote>
<ul>
<li>Calculamos la predicción en el <em>test</em> y evaluamos el poder de clasificación del modelo</li>
</ul>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">rf1.pred_test     &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>( rf1, <span class="dt">newdata =</span> dt_test))</a>
<a class="sourceLine" id="cb74-2" data-line-number="2">dt_test<span class="op">$</span>pred_rf1  &lt;-<span class="st"> </span>rf1.pred_test<span class="op">$</span><span class="st">`</span><span class="dt">predict(rf1, newdata = dt_test)</span><span class="st">`</span> </a></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw">head</span>(dt_test,<span class="dv">3</span>)</a></code></pre></div>
<pre><code>##    ATTORNEY CLMSEX MARITAL CLMINSUR SEATBELT CLMAGE   LOSS Y  pred_rf1
## 6         1      2       1        2        1     35  0.309 0 0.2483812
## 12        1      1       1        2        1     42 29.620 1 0.2207249
## 18        1      1       1        2        1     58  0.758 0 0.1995112</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="kw">tail</span>(dt_test,<span class="dv">3</span>)</a></code></pre></div>
<pre><code>##      ATTORNEY CLMSEX MARITAL CLMINSUR SEATBELT CLMAGE  LOSS Y    pred_rf1
## 1336        2      1       2        2        1     NA 0.576 0          NA
## 1337        1      2       1        2        1     46 3.705 0 0.431751239
## 1339        1      2       2        1        1     18 3.277 0 0.003433201</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw">summary</span>(dt_test)</a></code></pre></div>
<pre><code>##  ATTORNEY  CLMSEX    MARITAL    CLMINSUR   SEATBELT       CLMAGE     
##  1:214    1   :180   1   :185   1   : 43   1   :385   Min.   : 0.00  
##  2:188    2   :219   2   :195   2   :346   2   :  5   1st Qu.:19.00  
##           NA&#39;s:  3   3   :  5   NA&#39;s: 13   NA&#39;s: 12   Median :29.00  
##                      4   : 10                         Mean   :31.31  
##                      NA&#39;s:  7                         3rd Qu.:42.00  
##                                                       Max.   :78.00  
##                                                       NA&#39;s   :55     
##       LOSS                 Y             pred_rf1      
##  Min.   :   0.0050   Min.   :0.0000   Min.   :0.00007  
##  1st Qu.:   0.5175   1st Qu.:0.0000   1st Qu.:0.00615  
##  Median :   2.1645   Median :0.0000   Median :0.03819  
##  Mean   :   7.0917   Mean   :0.1144   Mean   :0.12815  
##  3rd Qu.:   3.7782   3rd Qu.:0.0000   3rd Qu.:0.22274  
##  Max.   :1067.6970   Max.   :1.0000   Max.   :0.78703  
##                                       NA&#39;s   :70</code></pre>
<ul>
<li>Con el <em>test</em> creamos un objeto de tipo ‘prediction’ y calculamos la curva ROC</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">dt_test.pred  &lt;-<span class="st"> </span><span class="kw">prediction</span>(<span class="kw">as.numeric</span>(rf1.pred_test<span class="op">$</span><span class="st">`</span><span class="dt">predict(rf1, newdata = dt_test)</span><span class="st">`</span>),dt_test<span class="op">$</span>Y) </a>
<a class="sourceLine" id="cb81-2" data-line-number="2">dt_test.perf  &lt;-<span class="st"> </span><span class="kw">performance</span>(dt_test.pred,<span class="st">&quot;tpr&quot;</span>,<span class="st">&quot;fpr&quot;</span>) </a></code></pre></div>
<ul>
<li>Evaluación del poder de clasificación del modelo RF1 vía curva ROC</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">rf1.test.auc &lt;-<span class="st"> </span><span class="kw">performance</span>(dt_test.pred ,<span class="st">&quot;auc&quot;</span>)<span class="op">@</span>y.values[[<span class="dv">1</span>]]</a></code></pre></div>
<ul>
<li>Gráfico de la curva ROC para el <em>test</em></li>
</ul>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="co">#win.graph()</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="kw">plot</span>( dt_test.perf , <span class="dt">col=</span><span class="st">&#39;red&#39;</span> , <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span> , <span class="dt">main=</span><span class="st">&quot;Curva ROC modelo RF - test&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;Tasa de falsos positivos&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Tasa de verdaderos positivos&quot;</span>)</a>
<a class="sourceLine" id="cb83-3" data-line-number="3"><span class="kw">abline</span>( <span class="dv">0</span> , <span class="dv">1</span>  , <span class="dt">col=</span><span class="st">&quot;blue&quot;</span> , <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb83-4" data-line-number="4"><span class="kw">abline</span>( <span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">1</span> , <span class="dt">col=</span><span class="st">&quot;gray40&quot;</span>   , <span class="dt">lty=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb83-5" data-line-number="5"><span class="kw">legend</span>( <span class="fl">0.4</span>, <span class="fl">0.2</span> , <span class="kw">c</span>(<span class="kw">paste0</span>(<span class="st">&quot;AUC (Random Forest)=&quot;</span>,<span class="kw">round</span>(rf1.test.auc,<span class="dv">4</span>)),<span class="st">&quot;AUC (Coin toss)=0.50&quot;</span>) ,<span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">lwd=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>) ,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>), <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-54-1.png" width="672" /></p>
<blockquote>
<p>Métrica de error del clasificador RF:</p>
</blockquote>
<ul>
<li>Error tipo I (<span class="math inline">\(\alpha\)</span>): 22.50%, indica el error que se comete clasificando una pérdida ‘severa’ como ‘no severa’</li>
<li>Error tipo II (<span class="math inline">\(\beta\)</span>): 43.15%, indica el error que se comete clasificando una pérdida ‘no severa’ como ‘severa’</li>
<li>% mala clasificación (<span class="math inline">\(%mc\)</span>) : 40.66%, indica el % de veces que el modelo clasifica incorrectamente las pérdidas</li>
<li>Accuracy = <span class="math inline">\(100 - %\)</span>: 59.34%, indica el % de veces que el modelo acierta clasificando las pérdidas</li>
<li>Area bajo la curva ROC <span class="math inline">\(AUC\)</span>: 0.6988, medida global del poder de clasificación del modelo</li>
<li>Finalmente calculamos la curva ROC junto con la métrica AUC</li>
</ul>
<blockquote>
<p>Resumiendo:</p>
</blockquote>
<p>Una función útil para obtener rápidamente el análisis de un clasificador binario es la siguiente:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">metricBinaryClass =<span class="st"> </span><span class="cf">function</span>( fitted.model , dataset , <span class="dt">cutpoint=</span><span class="ot">NULL</span> , <span class="dt">roc.graph=</span><span class="ot">TRUE</span>){</a>
<a class="sourceLine" id="cb84-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb84-3" data-line-number="3">  <span class="co"># fitted.model : The Binary Classification model that is under evaluation. If provided, dataset contains all variables in the fitted model (target and predictors).</span></a>
<a class="sourceLine" id="cb84-4" data-line-number="4">  <span class="co"># dataset      : If fitted.model is not provided, dataset should has only two columns, predictions and labels.</span></a>
<a class="sourceLine" id="cb84-5" data-line-number="5">  <span class="co"># cuttpoint    : potimal cutoff or cutpoint to be used to split continuous predictions into two response categories of target variable</span></a>
<a class="sourceLine" id="cb84-6" data-line-number="6">  <span class="co"># roc.graph    : If true, ROC curve graph for the model is shown </span></a>
<a class="sourceLine" id="cb84-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb84-8" data-line-number="8">  <span class="co">#install.packages(&quot;binaryLogic&quot;)</span></a>
<a class="sourceLine" id="cb84-9" data-line-number="9">  <span class="kw">library</span>(binaryLogic)</a>
<a class="sourceLine" id="cb84-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb84-11" data-line-number="11">  <span class="cf">if</span>( <span class="kw">missing</span>(fitted.model) <span class="op">|</span><span class="st"> </span><span class="kw">is.null</span>(fitted.model) ){</a>
<a class="sourceLine" id="cb84-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb84-13" data-line-number="13">    tabl  &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(dataset)</a>
<a class="sourceLine" id="cb84-14" data-line-number="14">  } </a>
<a class="sourceLine" id="cb84-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb84-16" data-line-number="16">  <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb84-17" data-line-number="17">    <span class="cf">if</span>( <span class="kw">class</span>(fitted.model)[<span class="dv">1</span>] <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;glm&#39;</span>,<span class="st">&#39;lm&#39;</span>,<span class="st">&#39;randomForest.formula&#39;</span>,<span class="st">&#39;randomForest&#39;</span>) ){</a>
<a class="sourceLine" id="cb84-18" data-line-number="18">      tabl.pred &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>( fitted.model, <span class="dt">newdata =</span> dataset ))</a>
<a class="sourceLine" id="cb84-19" data-line-number="19">      tabl &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(tabl.pred[[<span class="dv">1</span>]], dataset[,<span class="st">&#39;Y&#39;</span>] )) </a>
<a class="sourceLine" id="cb84-20" data-line-number="20">      tabl &lt;-<span class="st"> </span>tabl[<span class="op">!</span><span class="kw">is.na</span>(tabl[[<span class="dv">1</span>]]),]</a>
<a class="sourceLine" id="cb84-21" data-line-number="21">    }</a>
<a class="sourceLine" id="cb84-22" data-line-number="22">    <span class="cf">if</span>( <span class="kw">class</span>(fitted.model)[<span class="dv">1</span>] <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gbm&quot;</span>) ){</a>
<a class="sourceLine" id="cb84-23" data-line-number="23">      tabl.pred &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict.gbm</span>( fitted.model , <span class="dt">newdata =</span> dataset , <span class="dt">n.trees =</span> <span class="dv">5000</span> , <span class="dt">type=</span><span class="st">&quot;response&quot;</span> ))</a>
<a class="sourceLine" id="cb84-24" data-line-number="24">      tabl &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(tabl.pred[[<span class="dv">1</span>]], dataset[,<span class="st">&#39;Y&#39;</span>] )) </a>
<a class="sourceLine" id="cb84-25" data-line-number="25">      tabl &lt;-<span class="st"> </span>tabl[<span class="op">!</span><span class="kw">is.na</span>(tabl[[<span class="dv">1</span>]]),]</a>
<a class="sourceLine" id="cb84-26" data-line-number="26">    }</a>
<a class="sourceLine" id="cb84-27" data-line-number="27">    <span class="cf">if</span>( <span class="kw">class</span>(fitted.model)[<span class="dv">1</span>] <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;svm.formula&#39;</span>,<span class="st">&#39;svm&#39;</span>) ){</a>
<a class="sourceLine" id="cb84-28" data-line-number="28">      tabl.pred &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>( fitted.model, <span class="dt">newdata =</span> dataset ))</a>
<a class="sourceLine" id="cb84-29" data-line-number="29">      ids_NAs &lt;-<span class="st"> </span><span class="kw">na.index</span>(dataset)</a>
<a class="sourceLine" id="cb84-30" data-line-number="30">      tabl &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>( <span class="kw">cbind</span>(tabl.pred[[<span class="dv">1</span>]], dataset[<span class="op">-</span>ids_NAs,<span class="st">&#39;Y&#39;</span>]) ) </a>
<a class="sourceLine" id="cb84-31" data-line-number="31">      tabl &lt;-<span class="st"> </span>tabl[<span class="op">!</span><span class="kw">is.na</span>(tabl[[<span class="dv">1</span>]]),]</a>
<a class="sourceLine" id="cb84-32" data-line-number="32">    }</a>
<a class="sourceLine" id="cb84-33" data-line-number="33">  }</a>
<a class="sourceLine" id="cb84-34" data-line-number="34">  <span class="kw">colnames</span>(tabl) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;predicted&#39;</span>,<span class="st">&#39;actual&#39;</span>)</a>
<a class="sourceLine" id="cb84-35" data-line-number="35">  </a>
<a class="sourceLine" id="cb84-36" data-line-number="36">  <span class="co"># ROCR objects</span></a>
<a class="sourceLine" id="cb84-37" data-line-number="37">  <span class="kw">require</span>(ROCR)</a>
<a class="sourceLine" id="cb84-38" data-line-number="38">  obj.pred &lt;-<span class="st"> </span><span class="kw">prediction</span>(tabl<span class="op">$</span>predicted,tabl<span class="op">$</span>actual)</a>
<a class="sourceLine" id="cb84-39" data-line-number="39">  obj.perf &lt;-<span class="st"> </span><span class="kw">performance</span>(obj.pred,<span class="st">&quot;tpr&quot;</span>,<span class="st">&quot;fpr&quot;</span>)</a>
<a class="sourceLine" id="cb84-40" data-line-number="40">  obj.auc  &lt;-<span class="st"> </span><span class="kw">performance</span>(obj.pred,<span class="st">&quot;auc&quot;</span>)<span class="op">@</span>y.values[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb84-41" data-line-number="41">  <span class="co"># For ROC curve:</span></a>
<a class="sourceLine" id="cb84-42" data-line-number="42">  obj.perf<span class="op">@</span>alpha.values[[<span class="dv">1</span>]][obj.perf<span class="op">@</span>alpha.values[[<span class="dv">1</span>]]<span class="op">==</span><span class="ot">Inf</span>] &lt;-<span class="st"> </span><span class="kw">max</span>(obj.perf<span class="op">@</span>alpha.values[[<span class="dv">1</span>]][obj.perf<span class="op">@</span>alpha.values[[<span class="dv">1</span>]]<span class="op">!=</span><span class="ot">Inf</span>])</a>
<a class="sourceLine" id="cb84-43" data-line-number="43">  <span class="co"># KS criteria</span></a>
<a class="sourceLine" id="cb84-44" data-line-number="44">  KS.matrix=<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">abs</span>(obj.perf<span class="op">@</span>y.values[[<span class="dv">1</span>]]<span class="op">-</span>obj.perf<span class="op">@</span>x.values[[<span class="dv">1</span>]]), obj.perf<span class="op">@</span>alpha.values[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb84-45" data-line-number="45">  <span class="co"># KS cutoff</span></a>
<a class="sourceLine" id="cb84-46" data-line-number="46">  <span class="co"># colnames(KS.matrix) &lt;- c(&quot;KS-distance&quot;,&quot;cut-point&quot;)</span></a>
<a class="sourceLine" id="cb84-47" data-line-number="47">  ind.ks  &lt;-<span class="st"> </span><span class="kw">sort</span>( KS.matrix[,<span class="dv">1</span>] , <span class="dt">index.return=</span><span class="ot">TRUE</span> )<span class="op">$</span>ix[<span class="kw">nrow</span>(KS.matrix)] </a>
<a class="sourceLine" id="cb84-48" data-line-number="48">  </a>
<a class="sourceLine" id="cb84-49" data-line-number="49">  <span class="cf">if</span>( <span class="kw">missing</span>(cutpoint) <span class="op">|</span><span class="st"> </span><span class="kw">is.null</span>(cutpoint) ) cutpoint &lt;-<span class="st"> </span>KS.matrix[ind.ks,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb84-50" data-line-number="50">  </a>
<a class="sourceLine" id="cb84-51" data-line-number="51">  <span class="cf">if</span>( <span class="op">!</span>(<span class="kw">is.binary</span>(tabl)) ){</a>
<a class="sourceLine" id="cb84-52" data-line-number="52">    </a>
<a class="sourceLine" id="cb84-53" data-line-number="53">    <span class="co"># Make predictions objs.</span></a>
<a class="sourceLine" id="cb84-54" data-line-number="54">    <span class="co"># Binary metrics </span></a>
<a class="sourceLine" id="cb84-55" data-line-number="55">    tp =<span class="st"> </span><span class="kw">sum</span>( tabl<span class="op">$</span>predicted  <span class="op">&gt;</span><span class="st">  </span>cutpoint <span class="op">&amp;</span><span class="st"> </span>tabl<span class="op">$</span>actual <span class="op">&gt;</span><span class="st">  </span>cutpoint)</a>
<a class="sourceLine" id="cb84-56" data-line-number="56">    fp =<span class="st"> </span><span class="kw">sum</span>( tabl<span class="op">$</span>predicted  <span class="op">&gt;</span><span class="st">  </span>cutpoint <span class="op">&amp;</span><span class="st"> </span>tabl<span class="op">$</span>actual <span class="op">&lt;=</span><span class="st"> </span>cutpoint)</a>
<a class="sourceLine" id="cb84-57" data-line-number="57">    tn =<span class="st"> </span><span class="kw">sum</span>( tabl<span class="op">$</span>predicted  <span class="op">&lt;=</span><span class="st"> </span>cutpoint <span class="op">&amp;</span><span class="st"> </span>tabl<span class="op">$</span>actual <span class="op">&lt;=</span><span class="st"> </span>cutpoint)</a>
<a class="sourceLine" id="cb84-58" data-line-number="58">    fn =<span class="st"> </span><span class="kw">sum</span>( tabl<span class="op">$</span>predicted  <span class="op">&lt;=</span><span class="st"> </span>cutpoint <span class="op">&amp;</span><span class="st"> </span>tabl<span class="op">$</span>actual <span class="op">&gt;</span><span class="st">  </span>cutpoint) </a>
<a class="sourceLine" id="cb84-59" data-line-number="59">    pos =<span class="st"> </span>tp<span class="op">+</span>fn</a>
<a class="sourceLine" id="cb84-60" data-line-number="60">    neg =<span class="st"> </span>tn<span class="op">+</span>fp</a>
<a class="sourceLine" id="cb84-61" data-line-number="61">    acc=<span class="st">  </span><span class="dv">100</span><span class="op">*</span>(tp<span class="op">+</span>tn)<span class="op">/</span>(pos<span class="op">+</span>neg)</a>
<a class="sourceLine" id="cb84-62" data-line-number="62">    prec=<span class="st"> </span><span class="dv">100</span><span class="op">*</span>tp<span class="op">/</span>(tp<span class="op">+</span>fp)</a>
<a class="sourceLine" id="cb84-63" data-line-number="63">    sens=<span class="st"> </span><span class="dv">100</span><span class="op">*</span>tp<span class="op">/</span>(tp<span class="op">+</span>fn) <span class="co"># = tpr = recall = 1 - error alpha</span></a>
<a class="sourceLine" id="cb84-64" data-line-number="64">    spec=<span class="st"> </span><span class="dv">100</span><span class="op">*</span>tn<span class="op">/</span>(tn<span class="op">+</span>fp) <span class="co"># 1- error beta</span></a>
<a class="sourceLine" id="cb84-65" data-line-number="65">    fpr =<span class="st"> </span><span class="dv">100</span><span class="op">*</span>fp<span class="op">/</span>neg  <span class="co"># error beta (tipo II) = 1 - spec</span></a>
<a class="sourceLine" id="cb84-66" data-line-number="66">    fnr =<span class="st"> </span><span class="dv">100</span><span class="op">*</span>fn<span class="op">/</span>pos  <span class="co"># error alpha (tipo I) = 1- recall = 1- sens</span></a>
<a class="sourceLine" id="cb84-67" data-line-number="67">  }</a>
<a class="sourceLine" id="cb84-68" data-line-number="68">  </a>
<a class="sourceLine" id="cb84-69" data-line-number="69">  <span class="cf">if</span>( <span class="kw">is.binary</span>(tabl) ){</a>
<a class="sourceLine" id="cb84-70" data-line-number="70">    </a>
<a class="sourceLine" id="cb84-71" data-line-number="71">    tp =<span class="st"> </span><span class="kw">sum</span>( tabl<span class="op">$</span>predicted  <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>tabl<span class="op">$</span>actual <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb84-72" data-line-number="72">    fp =<span class="st"> </span><span class="kw">sum</span>( tabl<span class="op">$</span>predicted  <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>tabl<span class="op">$</span>actual <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb84-73" data-line-number="73">    tn =<span class="st"> </span><span class="kw">sum</span>( tabl<span class="op">$</span>predicted  <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>tabl<span class="op">$</span>actual <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb84-74" data-line-number="74">    fn =<span class="st"> </span><span class="kw">sum</span>( tabl<span class="op">$</span>predicted  <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>tabl<span class="op">$</span>actual <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) </a>
<a class="sourceLine" id="cb84-75" data-line-number="75">    pos =<span class="st"> </span>tp<span class="op">+</span>fn</a>
<a class="sourceLine" id="cb84-76" data-line-number="76">    neg =<span class="st"> </span>tn<span class="op">+</span>fp</a>
<a class="sourceLine" id="cb84-77" data-line-number="77">    acc=<span class="st">  </span><span class="dv">100</span><span class="op">*</span>(tp<span class="op">+</span>tn)<span class="op">/</span>(pos<span class="op">+</span>neg)</a>
<a class="sourceLine" id="cb84-78" data-line-number="78">    prec=<span class="st"> </span><span class="dv">100</span><span class="op">*</span>tp<span class="op">/</span>(tp<span class="op">+</span>fp)</a>
<a class="sourceLine" id="cb84-79" data-line-number="79">    sens=<span class="st"> </span><span class="dv">100</span><span class="op">*</span>tp<span class="op">/</span>(tp<span class="op">+</span>fn) <span class="co"># = tpr = recall = 1 - error alpha</span></a>
<a class="sourceLine" id="cb84-80" data-line-number="80">    spec=<span class="st"> </span><span class="dv">100</span><span class="op">*</span>tn<span class="op">/</span>(tn<span class="op">+</span>fp) <span class="co"># 1- error beta</span></a>
<a class="sourceLine" id="cb84-81" data-line-number="81">    fpr =<span class="st"> </span><span class="dv">100</span><span class="op">*</span>fp<span class="op">/</span>neg  <span class="co"># error beta (tipo II) = 1 - spec</span></a>
<a class="sourceLine" id="cb84-82" data-line-number="82">    fnr =<span class="st"> </span><span class="dv">100</span><span class="op">*</span>fn<span class="op">/</span>pos  <span class="co"># error alpha (tipo I) = 1- recall = 1- sens</span></a>
<a class="sourceLine" id="cb84-83" data-line-number="83">  }  </a>
<a class="sourceLine" id="cb84-84" data-line-number="84">  </a>
<a class="sourceLine" id="cb84-85" data-line-number="85">  <span class="cf">if</span>(roc.graph<span class="op">==</span><span class="ot">TRUE</span>){</a>
<a class="sourceLine" id="cb84-86" data-line-number="86">    <span class="kw">win.graph</span>()</a>
<a class="sourceLine" id="cb84-87" data-line-number="87">    <span class="kw">plot</span>( obj.perf  , <span class="dt">col=</span><span class="st">&#39;red&#39;</span> , <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;Tasa de falsos positivos&quot;</span> , <span class="dt">ylab=</span><span class="st">&quot;Tasa de verdaderos positivos&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Curva ROC modelo clasificación&quot;)</span></a>
<a class="sourceLine" id="cb84-88" data-line-number="88"><span class="st">    abline( 0.0 , 1.0 , col=&quot;</span>blue<span class="st">&quot;, lwd=2, lty=2)</span></a>
<a class="sourceLine" id="cb84-89" data-line-number="89"><span class="st">    abline( 0.0 , 0.0 , 1 , col=&quot;</span>gray40<span class="st">&quot; , lty=3)</span></a>
<a class="sourceLine" id="cb84-90" data-line-number="90"><span class="st">    legend( 0.45, 0.2 , c(paste0(&quot;</span><span class="kw">AUC</span> (Model)=<span class="st">&quot;,round(obj.auc,4)),&quot;</span><span class="kw">AUC</span> (Rolling dice)=<span class="fl">0.50</span><span class="st">&quot;) ,lty=c(1,2), lwd=c(2,2) ,col=c(&quot;</span>red<span class="st">&quot;,&quot;</span>blue<span class="st">&quot;), bty=&quot;</span>n<span class="st">&quot;)</span></a>
<a class="sourceLine" id="cb84-91" data-line-number="91"><span class="st">  }</span></a>
<a class="sourceLine" id="cb84-92" data-line-number="92"><span class="st">  </span></a>
<a class="sourceLine" id="cb84-93" data-line-number="93"><span class="st">  list(ClassError.tI=round(fnr,2), ClassError.tII=round(fpr,2), Accuracy=round(acc,2),Sensitivity = round(sens,2) , Specificity= round(spec,2), auc= obj.auc , Fisher.F1=round(2*prec*sens/(prec+sens),4) )</span></a>
<a class="sourceLine" id="cb84-94" data-line-number="94"><span class="st">  </span></a>
<a class="sourceLine" id="cb84-95" data-line-number="95"><span class="st">}</span></a></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"> <span class="kw">metricBinaryClass</span>( <span class="dt">fitted.model =</span> rf1 , <span class="dt">dataset=</span> dt_test , <span class="dt">cutpoint=</span>rf1.KScutoff , <span class="dt">roc.graph=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## $ClassError.tI
## [1] 22.5
## 
## $ClassError.tII
## [1] 44.52
## 
## $Accuracy
## [1] 58.13
## 
## $Sensitivity
## [1] 77.5
## 
## $Specificity
## [1] 55.48
## 
## $auc
## [1] 0.698887
## 
## $Fisher.F1
## [1] 30.8458</code></pre>
</div>
<div id="regresion" class="section level3">
<h3><span class="header-section-number">4.6.3</span> Regresión</h3>
<div class="info">
<p>Vamos a construir un modelo para prever las pérdidas.</p>
</div>
<blockquote>
<p>Modelo con <em>Random Forest</em> en <em>train</em></p>
</blockquote>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">fmla.rf2 &lt;-<span class="st"> </span><span class="kw">as.formula</span>(<span class="kw">paste0</span>(<span class="st">&#39;LOSS&#39;</span>,<span class="st">&#39;~&#39;</span>,<span class="kw">paste0</span>(<span class="kw">colnames</span>(df_autobi[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">8</span>)]),<span class="dt">collapse =</span> <span class="st">&quot;+&quot;</span>),<span class="dt">collapse =</span> <span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">112233</span>) <span class="co">#recomendado</span></a>
<a class="sourceLine" id="cb87-3" data-line-number="3"></a>
<a class="sourceLine" id="cb87-4" data-line-number="4">rf2 &lt;-<span class="st"> </span><span class="kw">randomForest</span>( fmla.rf2,</a>
<a class="sourceLine" id="cb87-5" data-line-number="5">                     <span class="dt">data =</span>dt_train,</a>
<a class="sourceLine" id="cb87-6" data-line-number="6">                     <span class="dt">ntree =</span> <span class="dv">5000</span>,</a>
<a class="sourceLine" id="cb87-7" data-line-number="7">                     <span class="dt">replace =</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb87-8" data-line-number="8">                     <span class="dt">mtry=</span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb87-9" data-line-number="9">                     <span class="dt">maxnodes =</span><span class="dv">50</span>,</a>
<a class="sourceLine" id="cb87-10" data-line-number="10">                     <span class="dt">importance =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb87-11" data-line-number="11">                     <span class="dt">na.action=</span>na.omit)</a>
<a class="sourceLine" id="cb87-12" data-line-number="12"></a>
<a class="sourceLine" id="cb87-13" data-line-number="13"><span class="kw">summary</span>(rf2)</a></code></pre></div>
<pre><code>##                 Length Class  Mode     
## call               9   -none- call     
## type               1   -none- character
## predicted        759   -none- numeric  
## mse             5000   -none- numeric  
## rsq             5000   -none- numeric  
## oob.times        759   -none- numeric  
## importance        12   -none- numeric  
## importanceSD       6   -none- numeric  
## localImportance    0   -none- NULL     
## proximity          0   -none- NULL     
## ntree              1   -none- numeric  
## mtry               1   -none- numeric  
## forest            11   -none- list     
## coefs              0   -none- NULL     
## y                759   -none- numeric  
## test               0   -none- NULL     
## inbag              0   -none- NULL     
## terms              3   terms  call     
## na.action        179   omit   numeric</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="kw">str</span>(rf2)</a></code></pre></div>
<pre><code>## List of 19
##  $ call           : language randomForest(formula = fmla.rf2, data = dt_train, ntree = 5000, replace = TRUE,      mtry = 4, maxnodes = 50, imp| __truncated__
##  $ type           : chr &quot;regression&quot;
##  $ predicted      : atomic [1:759] 2.481 0.673 37.787 1.805 4.297 ...
##   ..- attr(*, &quot;na.action&quot;)=Class &#39;omit&#39;  Named int [1:179] 1 9 19 25 27 40 43 46 50 51 ...
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:179] &quot;1&quot; &quot;10&quot; &quot;24&quot; &quot;30&quot; ...
##  $ mse            : num [1:5000] 543 499 466 463 501 ...
##  $ rsq            : num [1:5000] -0.636 -0.504 -0.403 -0.395 -0.511 ...
##  $ oob.times      : int [1:759] 1830 1844 1839 1796 1845 1867 1829 1890 1824 1844 ...
##  $ importance     : num [1:6, 1:2] 18.05 2.03 -3.02 4.07 6.17 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:6] &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; &quot;CLMINSUR&quot; ...
##   .. ..$ : chr [1:2] &quot;%IncMSE&quot; &quot;IncNodePurity&quot;
##  $ importanceSD   : Named num [1:6] 1.161 1.077 1.206 0.401 0.755 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; &quot;CLMINSUR&quot; ...
##  $ localImportance: NULL
##  $ proximity      : NULL
##  $ ntree          : num 5000
##  $ mtry           : num 4
##  $ forest         :List of 11
##   ..$ ndbigtree    : int [1:5000] 99 99 99 99 99 99 99 99 99 99 ...
##   ..$ nodestatus   : int [1:99, 1:5000] -3 -3 -3 -3 -3 -3 -3 -3 -1 -3 ...
##   ..$ leftDaughter : int [1:99, 1:5000] 2 4 6 8 10 12 14 16 0 18 ...
##   ..$ rightDaughter: int [1:99, 1:5000] 3 5 7 9 11 13 15 17 0 19 ...
##   ..$ nodepred     : num [1:99, 1:5000] 4.96 2.43 6.21 3.78 1.25 ...
##   ..$ bestvar      : int [1:99, 1:5000] 6 1 1 5 6 5 6 6 0 6 ...
##   ..$ xbestsplit   : num [1:99, 1:5000] 24.5 1.5 1.5 1.5 20.5 1.5 52.5 15.5 0 13.5 ...
##   ..$ ncat         : Named int [1:6] 1 1 1 1 1 1
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; &quot;CLMINSUR&quot; ...
##   ..$ nrnodes      : int 99
##   ..$ ntree        : num 5000
##   ..$ xlevels      :List of 6
##   .. ..$ ATTORNEY: num 0
##   .. ..$ CLMSEX  : num 0
##   .. ..$ MARITAL : num 0
##   .. ..$ CLMINSUR: num 0
##   .. ..$ SEATBELT: num 0
##   .. ..$ CLMAGE  : num 0
##  $ coefs          : NULL
##  $ y              : atomic [1:759] 10.892 0.33 11.037 0.138 3.538 ...
##   ..- attr(*, &quot;na.action&quot;)=Class &#39;omit&#39;  Named int [1:179] 1 9 19 25 27 40 43 46 50 51 ...
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:179] &quot;1&quot; &quot;10&quot; &quot;24&quot; &quot;30&quot; ...
##  $ test           : NULL
##  $ inbag          : NULL
##  $ terms          :Classes &#39;terms&#39;, &#39;formula&#39;  language LOSS ~ ATTORNEY + CLMSEX + MARITAL + CLMINSUR + SEATBELT + CLMAGE
##   .. ..- attr(*, &quot;variables&quot;)= language list(LOSS, ATTORNEY, CLMSEX, MARITAL, CLMINSUR, SEATBELT, CLMAGE)
##   .. ..- attr(*, &quot;factors&quot;)= int [1:7, 1:6] 0 1 0 0 0 0 0 0 0 1 ...
##   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. ..$ : chr [1:7] &quot;LOSS&quot; &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; ...
##   .. .. .. ..$ : chr [1:6] &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; &quot;CLMINSUR&quot; ...
##   .. ..- attr(*, &quot;term.labels&quot;)= chr [1:6] &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; &quot;CLMINSUR&quot; ...
##   .. ..- attr(*, &quot;order&quot;)= int [1:6] 1 1 1 1 1 1
##   .. ..- attr(*, &quot;intercept&quot;)= num 0
##   .. ..- attr(*, &quot;response&quot;)= int 1
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. ..- attr(*, &quot;predvars&quot;)= language list(LOSS, ATTORNEY, CLMSEX, MARITAL, CLMINSUR, SEATBELT, CLMAGE)
##   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:7] &quot;numeric&quot; &quot;ordered&quot; &quot;ordered&quot; &quot;ordered&quot; ...
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:7] &quot;LOSS&quot; &quot;ATTORNEY&quot; &quot;CLMSEX&quot; &quot;MARITAL&quot; ...
##  $ na.action      :Class &#39;omit&#39;  Named int [1:179] 1 9 19 25 27 40 43 46 50 51 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:179] &quot;1&quot; &quot;10&quot; &quot;24&quot; &quot;30&quot; ...
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;randomForest.formula&quot; &quot;randomForest&quot;</code></pre>
<blockquote>
<p>Importancia Relativa de las Variables <em>Input</em></p>
</blockquote>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="kw">varImpPlot</span>(rf2,<span class="dt">sort =</span> T,<span class="dt">main=</span><span class="st">&quot;Variable Importance&quot;</span>)</a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-59-1.png" width="672" /></p>
<blockquote>
<p>Previsión en <em>test</em></p>
</blockquote>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">rf2.prediction &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(rf2, <span class="dt">newdata =</span> dt_test))</a>
<a class="sourceLine" id="cb92-2" data-line-number="2">dt_test<span class="op">$</span>pred_rf2 &lt;-<span class="st"> </span>rf2.prediction[[<span class="dv">1</span>]] </a></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="kw">head</span>(dt_test, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##    ATTORNEY CLMSEX MARITAL CLMINSUR SEATBELT CLMAGE   LOSS Y  pred_rf1
## 6         1      2       1        2        1     35  0.309 0 0.2483812
## 12        1      1       1        2        1     42 29.620 1 0.2207249
## 18        1      1       1        2        1     58  0.758 0 0.1995112
##    pred_rf2
## 6  7.914495
## 12 8.488978
## 18 9.846624</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">tail</span>(dt_test, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##      ATTORNEY CLMSEX MARITAL CLMINSUR SEATBELT CLMAGE  LOSS Y    pred_rf1
## 1336        2      1       2        2        1     NA 0.576 0          NA
## 1337        1      2       1        2        1     46 3.705 0 0.431751239
## 1339        1      2       2        1        1     18 3.277 0 0.003433201
##       pred_rf2
## 1336        NA
## 1337 36.665696
## 1339  3.978978</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="kw">summary</span>(dt_test, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  ATTORNEY  CLMSEX       MARITAL    CLMINSUR   SEATBELT       CLMAGE     
##  1:214    1   :180   2      :195   1   : 43   1   :385   Min.   : 0.00  
##  2:188    2   :219   (Other):200   2   :346   2   :  5   1st Qu.:19.00  
##           NA&#39;s:  3   NA&#39;s   :  7   NA&#39;s: 13   NA&#39;s: 12   Median :29.00  
##                                                          Mean   :31.31  
##                                                          3rd Qu.:42.00  
##                                                          Max.   :78.00  
##                                                          NA&#39;s   :55     
##       LOSS                 Y             pred_rf1          pred_rf2      
##  Min.   :   0.0050   Min.   :0.0000   Min.   :0.00007   Min.   : 0.3916  
##  1st Qu.:   0.5175   1st Qu.:0.0000   1st Qu.:0.00615   1st Qu.: 2.0644  
##  Median :   2.1645   Median :0.0000   Median :0.03819   Median : 3.4303  
##  Mean   :   7.0917   Mean   :0.1144   Mean   :0.12815   Mean   : 6.3906  
##  3rd Qu.:   3.7782   3rd Qu.:0.0000   3rd Qu.:0.22274   3rd Qu.: 7.8241  
##  Max.   :1067.6970   Max.   :1.0000   Max.   :0.78703   Max.   :57.5121  
##                                       NA&#39;s   :70        NA&#39;s   :70</code></pre>
<blockquote>
<p>Graficamos la distribución de los valores estimados en el <em>train</em></p>
</blockquote>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="kw">plot</span>(<span class="kw">density</span>(dt_test<span class="op">$</span>pred_rf2[<span class="op">!</span><span class="kw">is.na</span>(dt_test<span class="op">$</span>pred_rf2) <span class="op">&amp;</span><span class="st"> </span>dt_test<span class="op">$</span>pred_rf2 <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span>]), <span class="dt">ylim=</span> <span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">25</span>) , <span class="dt">col=</span><span class="st">&quot;red&quot;</span> , <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="kw">lines</span>(<span class="kw">density</span>(dt_test<span class="op">$</span>LOSS[dt_test<span class="op">$</span>LOSS<span class="op">&lt;</span><span class="dv">30</span>]),<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">lty=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-62-1.png" width="672" /></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1">modelchecktest1 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>( <span class="kw">cbind</span>(<span class="dt">real=</span>dt_test<span class="op">$</span>LOSS , <span class="dt">predicted=</span>dt_test<span class="op">$</span>pred_rf2) )</a>
<a class="sourceLine" id="cb100-2" data-line-number="2">modelchecktest1[<span class="kw">is.na</span>(modelchecktest1)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb100-3" data-line-number="3"></a>
<a class="sourceLine" id="cb100-4" data-line-number="4"><span class="kw">summary</span>(modelchecktest1)</a></code></pre></div>
<pre><code>##       real             predicted     
##  Min.   :   0.0050   Min.   : 0.000  
##  1st Qu.:   0.5175   1st Qu.: 1.316  
##  Median :   2.1645   Median : 2.414  
##  Mean   :   7.0917   Mean   : 5.278  
##  3rd Qu.:   3.7782   3rd Qu.: 7.424  
##  Max.   :1067.6970   Max.   :57.512</code></pre>
<blockquote>
<p>Error de ajuste del modelo</p>
</blockquote>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw">plot</span>(modelchecktest1, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">100</span>) , <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">100</span>) ,  <span class="dt">pch=</span><span class="st">&quot;.&quot;</span> , <span class="dt">cex=</span><span class="fl">1.5</span>)</a>
<a class="sourceLine" id="cb102-2" data-line-number="2"><span class="kw">segments</span>( <span class="dv">0</span>, <span class="dv">0</span> , <span class="dv">100</span>, <span class="dv">100</span> , <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="02-Evaluation_files/figure-html4/unnamed-chunk-64-1.png" width="672" /></p>
<blockquote>
<p>Resumiendo</p>
</blockquote>
<p>Una función útil para medir el error:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw">modelMetrics</span>(<span class="dt">real=</span>modelchecktest1<span class="op">$</span>real, <span class="dt">pred=</span>modelchecktest1<span class="op">$</span>predicted )</a></code></pre></div>
<pre><code>##  Accuracy metrics (global):</code></pre>
<pre><code>## MAE(ref) = 8.9208</code></pre>
<pre><code>## MAE = 7.7751</code></pre>
<pre><code>## RMSE = 54.5763</code></pre>
<pre><code>## MAPE = 127.55</code></pre>
<pre><code>## MAPE(sim) = 68.64</code></pre>
<pre><code>## WMAPE = 109.64</code></pre>
<ul>
<li>Commentario: El error de ajuste del modelo de regresión es demasiado alto: <span class="math inline">\(RMSE= 54.57\)</span> y el <span class="math inline">\(MAPE=127.19%\)</span> Con estos errores de predicción, es preferible utilizar a un modelo de clasificación en lugar de un modelo de regresión.</li>
</ul>
<div class="rmdcomment">
<p><strong>Ejercicio sugerido</strong></p>
<ul>
<li><p>Ajustar un Modelo de Regresión Logística para <span class="math inline">\(Y\)</span> y comparar los resultados con los proporcionados por el <em>Random Forest</em></p></li>
<li><p>Ajustar un Modelo de Regresión Lineal para <span class="math inline">\(LOSS\)</span> y comparar los resultados con los proporcionados por el <em>Random Forest</em></p></li>
</ul>
</div>

</div>
</div>
<!-- </div> -->



<div class="footnotes">
<hr />
<ol start="6">
<li id="fn6"><p>Si queremos cambiar la ruta, podemos hacer ‘myWd &lt;- setwd(“Ruta y Nombre de la carpeta”)’.<a href="practica-en-r.html#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p><a href="https://CRAN.R-project.org/package=insuranceData" class="uri">https://CRAN.R-project.org/package=insuranceData</a><a href="practica-en-r.html#fnref7" class="footnote-back">↩</a></p></li>
<li id="fn8"><p><a href="https://www.rdocumentation.org/packages/insuranceData/versions/1.0/topics/AutoBi" class="uri">https://www.rdocumentation.org/packages/insuranceData/versions/1.0/topics/AutoBi</a><a href="practica-en-r.html#fnref8" class="footnote-back">↩</a></p></li>
<li id="fn9"><p>A loss is the injury or damage sustained by the insured in consequence of the happening of one or more of the accidents or misfortunes against which the insurer, in consideration of the premium, has undertaken to indemnify the insured.<a href="practica-en-r.html#fnref9" class="footnote-back">↩</a></p></li>
<li id="fn10"><p>The interquartile range of an observation variable is the difference of its upper and lower quartiles. It is a measure of how far apart the middle portion of data spreads in value<a href="practica-en-r.html#fnref10" class="footnote-back">↩</a></p></li>
<li id="fn11"><p><a href="https://www.rdocumentation.org/packages/randomForest/versions/4.6-12/topics/randomForest" class="uri">https://www.rdocumentation.org/packages/randomForest/versions/4.6-12/topics/randomForest</a><a href="practica-en-r.html#fnref11" class="footnote-back">↩</a></p></li>
<li id="fn12"><p><a href="https://www.r-bloggers.com/a-small-introduction-to-the-rocr-package/" class="uri">https://www.r-bloggers.com/a-small-introduction-to-the-rocr-package/</a><a href="practica-en-r.html#fnref12" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="metodos-de-re-muestreo.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modelos-de-regresion-lineal.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": ["bookdown-start.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
